	.TITLE	FCSRES - FCS RESIDENT LIBRARY FILE
	.IDENT	/29.01/
; 
; 		COPYRIGHT (c) 1982, 1989 BY
; 	DIGITAL EQUIPMENT CORPORATION, MAYNARD
; 	 MASSACHUSETTS.  ALL RIGHTS RESERVED.
;  
; THIS  SOFTWARE  IS FURNISHED UNDER A LICENSE AND MAY
; BE USED AND  COPIED  ONLY  IN  ACCORDANCE  WITH  THE
; TERMS  OF SUCH LICENSE AND WITH THE INCLUSION OF THE
; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR ANY  OTHER
; COPIES  THEREOF  MAY  NOT  BE  PROVIDED OR OTHERWISE
; MADE AVAILABLE TO ANY OTHER  PERSON.   NO  TITLE  TO
; AND OWNERSHIP OF THE SOFTWARE IS HEREBY TRANSFERRED.
;  
; THE  INFORMATION  IN  THIS  SOFTWARE  IS  SUBJECT TO
; CHANGE WITHOUT NOTICE AND SHOULD  NOT  BE  CONSTRUED
; AS  A  COMMITMENT  BY DIGITAL EQUIPMENT CORPORATION.
;  
; DIGITAL ASSUMES NO RESPONSIBILITY  FOR  THE  USE  OR
; RELIABILITY  OF  ITS  SOFTWARE  ON EQUIPMENT THAT IS
; NOT SUPPLIED BY DIGITAL.
; PETER H. LIPMAN	22-OCT-74
;
;
; PREVIOUSLY MODIFIED BY
;
;	S. RUZICH
;
; MODIFICATIONS:
;
;	S. M. THOMAS	18-FEB-83
;
;	SMT021 -- SET UP R1 TO POINT TO FNB BEFORE
;		  CALLING .FIND FROM .DLFNB
;
;	L. B. McCulley		21-July-1989		29.01
;		LBM205 - add *WARNING* that this module may be outdated and
;			dangerous since FCSRES and FCSFSL were merged back in
;			M-PLUS v3.  The descriptions about rebuilding FCSRES
;			are almost certainly incomplete if not downright wrong.
;
; ** WARNING ** ** WARNING ** ** WARNING ** ** WARNING ** ** WARNING **
;
; This module was not updated when changes were made to allow a single image
; to satisfy references to both FCSRES and FCSFSL.  There may well be problems
; as a result of procedural changes made at that time not being reflected in
; the procedures described below.  These procedures are not being reviewed at
; this time for possible problems, this warning is simply included as a caveat
; to the user that they have not been verified at present.  Potential problems
; are most likely if entry points are added or deleted (since FCSRES entries
; are vectored and have been for a long time, rearranging entry points almost
; guarantees problems).  Rebuilding FCSRES with modified code is, of course,
; unsupported by Digital's RSX Development group and should be supported by
; whoever is responsible for the modified code.  The process described below
; for rebuilding FCSRES may or may not have evolved as a result of the changes
; made to merge FCSRES and FCSFSL, if so the symptoms are expected to occur 
; when building the library rather than when running tasks that use it.
;
; THIS FILE DOCUMENTS HOW TO BUILD AN FCS RESIDENT LIBRARY,
; AND IT DEFINES ALL OF THE POSSIBLE MODULES THAT MIGHT GO INTO
; SUCH A LIBRARY.
;
; IT SHOULD BE UNDERSTOOD THAT PRECISELY HOW MUCH GOES INTO FCSRES
; IS ACTUALLY DEPENDENT ON WHICH PROGRAMS ARE GOING TO USE IT AND WHAT
; THOSE PROGRAMS REQUIRE.  THE IMPORTANT POINT TO BEAR IN MIND
; IS THAT A PROGRAM LINKING TO FCSRES MAY NOT GET MISSING FCS MODULES
; FROM THE SYSLIB.OLB OBJECT LIBRARY FILE AS WELL. A PROGRAM NEEDING
; FCS MODULES WHICH WERE NOT PLACED IN FCSRES WOULD HAVE NO CHOICE
; BUT TO LINK WITHOUT FCSRES AND USE ALL THE MODULES OUT OF SYSLIB.
;
; FOR THE OBVIOUS REASONS OF SIZE, THE MINIMUM AMOUNT SHOULD BE PUT IN
; FCSRES CONSISTENT WITH THE NEEDS OF THE PROGRAMS USING IT.
;
; THOSE ENTRY POINTS THAT ARE INVOKED BY MACROS ARE DOCUMENTED BELOW
; SO THAT IT IS POSSIBLE TO PICK WHAT SHOULD GO INTO FCSRES.
;
; IT IS INTENDED THAT THIS FILE BE EDITED TO ELIMINATE UNDESIRED
; MODULES FROM FCSRES.
;
;	THE ACTUAL BUILDING OF FCSRES INVOLVES THE FOLLOWING:
;	1) ASSEMBLE THIS MODULE
;
;	MAC> FCSRES,FCSRES=FCSRES
;
;	2) BUILD THE LIBRARY
;
;	SET /UIC=[1,1]
;
; TO BUILD NON-ANSI FCSRES FOR A MAPPED RSX-11M SYSTEM
; OR BUILD FCSRES (NECESSARILY ANSI) FOR AN RSX-11M-PLUS SYSTEM:
;
;	TKB>[1,1]FCSRES/-HD/LI/MM/PI,[1,34]FCSRES,[1,1]FCSRES=[200,200]FCSRES
;	TKB>/
;	TKB>STACK=0
;	TKB>PAR=FCSRES:0:20000
;	TKB//
;
; TO BUILD A NON-ANSI FCSRES ON AN UNMAPPED RSX-11M SYSTEM:
;
;	TKB>[1,1]FCSRES/-HD/LI/-MM/PI,[1,34]FCSRES,[1,1]FCSRES=[200,200]FCSRES
;	TKB>/
;	TKB>STACK=0
;	TKB>PAR=FCSRES:140000:20000
;	TKB>//
;
; TO BUILD ANSI FCSRES FOR A MAPPED RSX-11M SYSTEM:
;
;	TKB>[1,1]FCSRES/-HD/LI/MM/PI,[1,34]FCSRES,[1,1]FCSRES=[200,200]FCSRES
;	TKB>LB:[1,1]ANSLIB/DL
;	TKB>/
;	TKB>STACK=0
;	TKB>PAR=FCSRES:0:20000
;	TKB//
;
; TO BUILD A ANSI FCSRES ON AN UNMAPPED RSX-11M SYSTEM:
;
;	TKB>[1,1]FCSRES/-HD/LI/-MM/PI,[1,34]FCSRES,[1,1]FCSRES=[200,200]FCSRES
;	TKB>LB:[1,1]ANSLIB/DL
;	TKB>/
;	TKB>STACK=0
;	TKB>PAR=FCSRES:140000:20000
;	TKB>//
;


	.MCALL	CALLR
	.PSECT	$$RESL,RO
;
; OPENING FILES
;
	.GLOBL	.OPENR		;
.OPEN::				;OPEN$X, OPNS$X, OPNT$X
.OPFID::CALLR	.OPENR		;OFID$X CAN USE THE OPEN$X CODE
.OPFNB::CALLR	.OFNBR		;OFNB$X
;
; CLOSING FILES
;
	.GLOBL	.CLOSE		;CLOSE$
;
; TRUNCATE CLOSE
;
	.GLOBL	.TRNCL
;
; RECORD I/O
;
	.GLOBL	.GET,.PUT	;GET$, AND PUT$, GET$R, AND PUT$R
.PUTSQ::CALLR	.PUT		;PUT$S CAN USE PUT$ CODE
.GETSQ::CALLR	.GET		;GET$S CAN USE GET$ CODE
;
; ARITH AND DARITH ROUTINES 
;
	.GLOBL	$DIV,$DDIV 	;
;
; BLOCK I/O
;
	.GLOBL	.READ,.WRITE,.WAIT ;READ$, WRITE$, AND WAIT$
;
; DELETE FILE UPON CLOSE
;
	.GLOBL	.MRKDL		;USED BY OPNT$D
;
; FILE EXTENSION
;
	.GLOBL	.EXTND
;
; DIRECTORY OPERATIONS
;
	.GLOBL	.FIND,.ENTER,.REMOV
;
; ISSUE GENERAL QI/O AND SPECIAL MAGTAPE FUNCTION QI/OS
;
	.GLOBL	.XQIO,.CTRL
;
;
; RETURN MASK SPECIFYING FCS ASSEMBLY PARAMETERS
;
	.GLOBL	.FCTYP
;
; FLUSH BLOCK BUFFER TO FILE AS IF AT END-OF-FILE
;
	.GLOBL	.FLUSH
;
;-----------------------------------------------------------------------
;
; AS IT STANDS, THIS FCSRES.MAC WILL BUILD TO A NON-ANSI 4K FCS RESIDENT
; LIBRARY ON AN RSX-11M SYSTEM.  SUCH AN FCSRES CONTAINS EVERY EXECUTABLE FCS
; MODULE FROM RSX-11M SYSLIB.OLB. 
;
; IF YOU INTEND TO BUILD AN ANSI 4K FCS RESIDENT LIBRARY ON AN RSX-11M SYSTEM,
; OR AN RSX-11M-PLUS SYSTEM, YOU MUST REMOVE A NUMBER OF ENTRY POINTS IF YOU
; WISH TO BRING THE SIZE OF FCSRES BELOW 4096 WORDS.  IF YOU REMOVE (OR COMMENT
; OUT) THE FOLLOWING ENTRY POINTS, THEN THIS FILE WILL BUILD TO A 4K ANSI
; FCSRES. 
;
; IF YOU NEED ANY OF THE FOLLOWING ENTRY POINTS IN A 4K ANSI FCSRES, THEN YOU
; MUST REMOVE ONE OR MORE OF THE ABOVE ENTRY POINTS, UNTIL THE EDITED FILE
; BUILDS TO A 4K FCSRES. 

;
; DELETE FILES
;
	.GLOBL	.DELET		;DELET$

.DLFNB::TST	F.BDB(R0)	;DELETE BY FILE NAME BLOCK; IS THE FILE OPEN?
	BNE	10$		;YES- NO PROBLEM
	MOV	R0,R1		; POINT TO FDB
	ADD	#F.FNB,R1	; ADD IN F.FNB TO POINT TO FNB
	CALL	.FIND		;NO - FIND FILE ID, TO AVOID PARSE IN .DELETE
	BCC	10$		;DELETE IF NO ERROR
	RETURN			;REPORT ERROR
10$:	CALLR	.DELET		;DELETE
;
; FILE POSITIONING
;
	.GLOBL	.POINT,.MARK
;
; READ AND WRITE FILE STORAGE REGION CELLS
;
	.GLOBL	.RDFDR,.WDFDR,.RFOWN,.WFOWN,.RDFFP,.WDFFP
;
;
; RENAME FILE
;
	.GLOBL	.RENAM
;
; ESTABLISH DIRECTORY ID
;
	.GLOBL	.GTDID,.GTDIR
;
	.END


