	$BEGIN	RDRN,<28.1>,<READ NEXT BLOCK RANDOM>
; 
; THIS  SOFTWARE  IS FURNISHED UNDER A LICENSE AND MAY
; BE USED OR COPIED ONLY IN ACCORDANCE WITH THE  TERMS
; OF SUCH LICENSE.
;  
; COPYRIGHT (c) 1982 BY DIGITAL EQUIPMENT CORPORATION.
; ALL RIGHTS RESERVED.
; 
; PETER H. LIPMAN 21-AUG-73
;
;+
; READ THE NEXT BLOCK FROM THE FILE, WRITING THE CURRENT ONE
; IF THE "DIRTY BIT" IS SET.  BLOCK ORIENTED FILES ONLY!!
;
; INPUTS:
;	R0 = FDB ADDRESS
; OUTPUTS:
;	C=0 IF OK, C=1 IF ERROR AND F.ERR SET TO ERROR CODE
;	R0 PRESERVED, R1-R5 ALTERED
;-
..RDRN::BITB	#FD.WRT,F.BKP1(R0) ;MUST WE WRITE THE BLOCK
	BEQ	20$		;BRANCH IF NO
	CALL	..WTWA		;WRITE THIS BLOCK, INC VBN
	BCS	10$
	CALL	..RWAC		;AND READ THE CURRENT VBN
10$:	RETURN
20$:	CALL	..RWAT		;OTHERWISE JUST READ THE NEXT BLOCK
	RETURN
;
;
	$END	RDRN
;
;
	.END
