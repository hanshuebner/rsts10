TITLE	DBDEF,<RH11/RM02/03/05/80/RP04/05/06/07 REG DEFS>,0A,10-MAY-91,MHB/RVR/FEK/VAM

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR DBDEF
;+
;
;  000	RRF  06-MAR-81	CREATION - COPIED FROM V7.0-08
;  001	FEK  23-DEC-82	ADD DUAL-PORT DEFINITIONS
;  002  VAM  01-Apr-85	Add RHWCK symbol
;
;-

; REGISTER OFFSETS

.DSECT

RHCS1:	.BLKW			;CONTROL/STATUS 1 (CSR)
RHWC:	.BLKW			;WORD COUNT
RHBA:	.BLKW			;BUS ADDRESS <15-0>
RBDA:	.BLKW			;DESIRED SECTOR/TRACK ADDRESS
RHCS2:	.BLKW			;CONTROL/STATUS 2
RHDS:	.BLKW			;DRIVE STATUS
RHER:	.BLKW			;ERROR REGISTER 1
RHAS:	.BLKW			;ATTENTION SUMMARY
	.BLKW			;LOOK AHEAD
	.BLKW			;DATA BUFFER
RHMR:	.BLKW			;MAINTENANCE
	.BLKW			;DRIVE TYPE
	.BLKW			;SERIAL NUMBER
RBOF:	.BLKW			;OFFSET
RBDC:	.BLKW			;DESIRED CYLINDER
RBCC:	.BLKW			;CURRENT CYLINDER
RMMR2:				;RM02/03/05/80/RP07 MAINTENANCE REGISTER #2
RBER2:	.BLKW			;RP04/05/06 ERROR REGISTER #2
RMER2:				;RM02/03/05/80/RP07 ERROR REGISTER #2
RBER3:	.BLKW			;RP04/05/06 ERROR REGISTER #3
RBEC1:	.BLKW			;ECC POSITION
RBEC2:	.BLKW			;ECC PATTERN


; CONTROL/STATUS 1 BIT ASSIGNMENTS (RHCS1)

.DSECT	1400

	.BLKB	400		;BUS ADDRESS <17-16>
	.BLKB	.		;UNIBUS PORT SELECT
RHDVA:	.BLKB	.		;DRIVE AVAILABLE			;FEK001
	.BLKB	.		;UNUSED
RHMCPE:	.BLKB	.		;MASSBUS CONTROL PARITY ERROR
RHTRE:	.BLKB	.		;TRANSFER ERROR
	.BLKB	.		;SPECIAL CONDITION

; FUNCTIONS

.DSECT	1

	.BLKB	2		;NOP
	.BLKB	2		;STANDBY (UNLOAD)
SEEK:	.BLKB	2		;SEEK
RECAL:	.BLKB	2		;RECALIBRATE (HOME SEEK)
RHESET:	.BLKB	2		;DRIVE RESET
RELDP:	.BLKB	2		;RELEASE (DUAL PORT)			;FEK001
OFFSET:	.BLKB	2		;TRACK OFFSET
	.BLKB	2		;RETURN TO CENTERLINE
	.BLKB	2		;READIN PRESET
PAKACK:	.BLKB	2		;PACK ACKNOWLEGE

; CONTROL/STATUS 2 BIT ASSIGNMENTS (RHCS2)

.DSECT	7

	.BLKB	1		;UNIT SELECT
	.BLKB	.		;BUS ADDRESS INCREMENT INHIBIT
	.BLKB	.		;PARITY TEST
RHCLR:	.BLKB	.		;CONTROLLER CLEAR
	.BLKB	.		;INPUT READY
	.BLKB	.		;OUTPUT READY
	.BLKB	.		;MASSBUS DATA PARITY ERROR
	.BLKB	.		;MISSED TRANSFER
	.BLKB	.		;PROGRAM ERROR
RHNEM:	.BLKB	.		;NON-EXISTENT MEMORY
RHNED:	.BLKB	.		;NON-EXISTENT DRIVE
	.BLKB	.		;UNIBUS PARITY ERROR
RHWCK:	.BLKB	.		;WRITE CHECK				;002
	.BLKB	.		;DATA LATE

; DRIVE STATUS BIT ASSIGNMENTS (RHDS)

.BSECT

	.BLKB	.		;5 IN/SEC
	.BLKB	.		;20 IN/SEC
	.BLKB	.		;DRIVE TO INNER GUARD
	.BLKB	.		;GO REVERSE
	.BLKB	.		;DIFFERENCE LESS THAN 64
	.BLKB	.		;DIFFERENCE EQUALS 1
RBVV:	.BLKB	.		;VOLUME VALID
RHDRY:	.BLKB	.		;DRIVE READY
RHDPR:	.BLKB	.		;DRIVE PRESENT
RBPGM:	.BLKB	.		;PROGRAMABLE
	.BLKB	.		;LAST SECTOR TRANSFERED
	.BLKB	.		;WRITE LOCKED
RHMOL:	.BLKB	.		;MEDIUM ON LINE
RHPIP:	.BLKB	.		;POSITIONING IN PROGRESS
RHERR:	.BLKB	.		;ERROR
RHATA:	.BLKB	.		;ATTENTION ACTIVE

; RM/RP OFFSET REGISTER DEFINITIONS (RBOF)

.BSECT	HIGH

	.BLKB	.		;UNUSED
RMSSEI:	.BLKB	.		;RM80 SKIP SECTOR ERROR INHIBIT
RBHCI:	.BLKB	.		;HEADER COMPARE INHIBIT
RBECI:	.BLKB	.		;ECC INHIBIT
RM32ST:				;RM02/03/05/80 32 SECTOR FORMAT
RB22ST:	.BLKB	.		;RP04/05/06 22 SECTOR FORMAT
	.BLKB	.		;UNUSED
	.BLKB	.		;UNUSED
RBSCG:	.BLKB	.		;RP04/05/06 SERVO HEAD SIGN CHANGE

; OFFSET REGISTER VALUES (RBOF)

.EQUATE	FMT22,	10000		;22 SECTOR/TRACK & ECC ENABLE (RP04/RP05/RP06)
.EQUATE	FMT16,	10000		;16 BIT MODE & ECC ENABLE (RM02/03/05/80/RP07)


; ERROR REGISTER 1 BIT ASSIGNMENTS (RHER)

.BSECT

RHILF:	.BLKB	.		;ILLEGAL FUNCTION
RHILR:	.BLKB	.		;ILLEGAL REGISTER
RHRMR:	.BLKB	.		;REGISTER MODIFICATION REFUSED
	.BLKB	.		;PARITY ERROR
	.BLKB	.		;FORMAT ERROR
	.BLKB	.		;WRITE CLOCK FAILED
RBECH:	.BLKB	.		;HARD ERROR
RBHCRC:	.BLKB	.		;HEADER COMPARE ERROR
RBHCE:	.BLKB	.		;HEADER CRC ERROR
RBAO:	.BLKB	.		;ADDRESS OVERFLOW
RBIAE:	.BLKB	.		;INVALID ADDRESS
RBWLE:	.BLKB	.		;WRITE LOCKED
RBDTE:	.BLKB	.		;DRIVE TIMING
	.BLKB	.		;OPERATION INCOMPLETE
RHUNS:	.BLKB	.		;UNSAFE
RBDCK:	.BLKB	.		;DATA CHECK

; RM02/03/05/80/RP07 ERROR REGISTER 2 BIT ASSIGNMENTS (RMER2)

.BSECT

	.BLKB	.		;UNUSED
	.BLKB	.		;UNUSED
	.BLKB	.		;UNUSED
	.BLKB	.		;UNUSED
	.BLKB	.		;UNUSED
RMSSE:	.BLKB	.		;RM80 SKIP-SECTOR ERROR
	.BLKB	.		;UNUSED
	.BLKB	.		;UNUSED
	.BLKB	.		;UNUSED
	.BLKB	.		;UNUSED
RMLBC:	.BLKB	.		;LOSS OF BIT CLOCK
RMLSC:	.BLKB	.		;LOSS OF SYSTEM CLOCK
RMIVC:	.BLKB	.		;INVALID COMMAND
	.BLKB	.		;OPERATOR PLUG ERROR
RMSKI:	.BLKB	.		;SEEK INCOMPLETE (RP07 RECAL'S AUTOMATICALLY)
RMBSE:	.BLKB	.		;BAD SECTOR ERROR



.NLIST
;MACROS FOR DEFINING MASSBUS DISKS
.SBTTL	MASSBUS DISK MACROS

;DEFINE A MASSBUS DISKS' ID AND GEOMETRY
.MACRO	MBDSK	NAME,MBUSID,MAXTRK,MAXSEC
.IF	NB	NAME
 .EQUATE	NAME'ID, MBUSID	;NAME (+RHDRQ IF DUAL PORT)
 .EQUATE	NAME'S1, MAXTRK*MAXSEC	;NAME HAS MAXTRK TRACKS
 .EQUATE	NAME'S2, MAXSEC	; AND MAXSEC SECTORS/TRACK
.ENDC
.ENDM	MBDSK

;GENERATE A TABLE OF VALID MASSBUS DISK ID'S (LOW BYTE ONLY)
.MACRO	MASSID	DSKLST
.IRP	NAME,<DSKLST>
.IF	NB	NAME
  .BYTE	NAME'ID&377
.ENDC
.ENDR
  .BYTE	0	;TABLE ENDS WITH 0 ENTRY
  .EVEN
.ENDM	MASSID

;GENERATE A TABLE OF DISK GEOMETRIES (SECTOR AND TRACK SIZES, ONLY)
.MACRO	MASSIZ	DSKLST
.IRP	NAME,<DSKLST>
.IF	NB	NAME
  .WORD	NAME'S1	;NAME #TRKS*#SECS/TRK (=#BLKS/CYL FOR NAME)
  .WORD	NAME'S2	;NAME #SECS/TRK
.ENDC
.ENDR
  .WORD	0	;TABLE ENDS WITH 0 ENTRY
.ENDM	MASSIZ

; DEFINE THE MASSBUS DISKS

MBDSK	RP04,	<RHMOH!20>,	19.,	22.
MBDSK	RP05,	<RHMOH!21>,	19.,	22.
MBDSK	RP06,	<RHMOH!22>,	19.,	22.
MBDSK	RM03,	<RHMOH!24>,	 5.,	32.
MBDSK	RM02,	<RHMOH!25>,	 5.,	32.
MBDSK	RM80,	<RHMOH!26>,	14.,	31.
MBDSK	RM05,	<RHMOH!27>,	19.,	32.
MBDSK	RP07,	<RHMOH!42>,	32.,	50.

;DEFINE 2 SPARES

MBDSK	RPXX,	<RHMOH!00>,	 0.,	 0.
MBDSK	RMXX,	<RHMOH!00>,	 0.,	 0.

.LIST

