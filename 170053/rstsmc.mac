.IIF	NDF	L$$IST, .NLIST
TITLE	RSTS,<RSTS SPECIFIC RSX MACROS>,07,24-APR-89,SJM,WRM

;
;		COPYRIGHT (c) 1974, 1989 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;


;+
;		'SCCA$S'
;
; THE SCCA$S MACRO IS A RSTS/E MACRO TO ENABLE OR DISABLE CTRL/C TRAPPING
; BY THE RSX EMULATOR. NO DIRECTIVE IS GENERATED.
;
; MACRO CALL:	SCCA$S	<AST>
;
; DESCRIPTION: THIS MACRO ENABLES OR DISABLES CTRL/C TRAPPING WITHOUT ISSUING
; A DIRECTIVE.  THE ARGUMENT IS ASSUMED TO HAVE THE FOLLOWING MEANING:
;
;	AST=AST SERVICE ENTRY ADDRESS.
;
; THE OPTIONAL PARAMETER AST, THE ASYNCHRONOUS CTRL/C TRAP ADDRESS, IS MOVED 
; TO ABSOLUTE LOCATION 24(8) WHICH ENABLES CTRL/C TRAPPING IN THE RSTS/E RSX
; EMULATOR. WHEN THE PARAMETER IS ABSENT, ABSOLUTE LOCATION 24(8) IS CLEARED 
; WHICH DISABLES CTRL/C TRAPPING IN THE EMULATOR.
;
;-
	.MACRO	SCCA$S	AST
	.IF	NB	<AST>
	MOV	AST,@#24
	.IFF
	CLR	@#24
	.ENDC
	.ENDM	SCCA$S



;+
;		'SSTX$'
;
; THE SSTX$ MACRO IS A RSTS/E MACRO TO TERMINATE EXECUTION OF SYNCHRONOUS
; OR ASYNCHRONOUS TRAP SERVICE ROUTINES WHERE SUPERVISOR MODE IS USED. 
; NO DIRECTIVE IS GENERATED.
;
; MACRO CALL:	SSTX$
;
; USER STACK AT TIME OF SSTX$:
;
;	SP ->	PC TO RETURN TO
;		PSW AT THE TIME OF TRAP
;
; NOTE IF THE TRAP WAS A MEMORY PROTECTION VIOLATION THEN THE SERVICE
; ROUTINE MUST REMOVE THE ADDITIONAL MEMORY REGISTER DATA FROM THE 
; STACK BEFORE ISSUING THE SSTX$ DIRECTIVE.
;
; DESCRIPTION: THIS MACRO LOOKS AT BITS 14&15 OF THE PSW ON THE STACK TO
; DETERMINE WHICH MODE THE USER WILL BE RETURNING TO. IF THE NEW MODE IS
; USER MODE THEN A RTI IS DONE, IF THE NEW MODE IS SUPERVISOR THEN A
; SWITCH MODE INSTRUCTION TO SUPERVISOR MODE AT LOCATION 0 IS DONE. IN THIS
; CASE THE DIGITAL SUPPLIED CSM SUPPORT MODULE IS EXPECTED AT THAT LOCATION.
; 
;-

	.MACRO	SSTX$,?A$
	TST	2(SP)
	BPL	A$
	RTI
A$:	CSM	#0
	.ENDM	SSTX$


.IIF	NDF	L$$IST, .LIST

