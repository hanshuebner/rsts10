	.TITLE	.X.EX
	.IDENT	/04/

;
; COPYRIGHT   1974,  DIGITAL  EQUIPMENT  CORP.,  MAYNARD,   MASS.
;
; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
; ON A  SINGLE COMPUTER SYSTEM AND CAN BE  COPIED (WITH INCLUSION
; OF DEC'S COPYRIGHT  NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
;
; THE  INFORMATION  IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
; NOTICE  AND  SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
; EQUIPMENT CORPORATION.
;
; DEC  ASSUMES NO  RESPONSIBILITY  FOR  THE  USE  OR  RELIABILITY
; OF  ITS  SOFTWARE ON  EQUIPMENT WHICH  IS  NOT SUPPLIED BY DEC.
;
; VERSION 04
;
; C.MONIA 24-JUN-74
;
; MODIFIED BY:
;
;	T. M. MARTIN	9-NOV-81
;			PLACE CODE IN PIC I-SPACE PSECT
;
; COMMON CODE TO ISSUE A DIRECTIVE AND EXIT TO FORTRAN PROGRAM
;
; MACRO LIBRARY CALLS
;
 
	.MCALL	CALL,DIR$,RETURN,.PICOD
 
;
; LOCAL MACROS
;
; SOB	REG,TAG
;

	.MACRO	SOB	REG,TAG
	DEC	REG
	BNE	TAG
	.ENDM

.PAGE
.SBTTL	COMMON CODE -- .X.EXT, .X.EX1
;
;
; .X.EXT -- COMMON CODE TO ISSUE A DIRECTIVE AND EXIT.
;
;	THIS ROUTINE WILL PUSH  THE DIRECTIVE ONTO THE USER'S STACK,
; ISSUE THE DIRECTIVE, RETURN STATUS, THEN TRANSFER CONTROL TO THE
; USER'S PROGRAM.
;
;	PRIOR TO CALLING THIS ROUTINE, THE REMAINDER OF THE DPB
; (IF ANY) MUST BE ON THE STACK.
;
;
; CALLING SEQUENCE:
;
;	CALL	.X.EXT
;	.BYTE	(DIC),(DPB SIZE)
;
;
; CONTROL IS TRANSFERRED TO THE ALTERNATE ENTRY POINT, '.X.EX1', VIA A JMP
; IF THE DIRECTIVE HAS ALREADY BEEN PUSHED ONTO THE STACK.
;
;
;
	.PICOD			; PLACE CODE IN PIC I-SPACE PSECT
.X.EXT::			;
	MOV	@(SP)+,-(SP)	; REPLACE TOP OF STACK WITH DIC,DPB SIZE
.X.EX1::			;
	DIR$			; ISSUE THE DIRECTIVE
	MOV	(SP)+,R0	; GET ADDRESS OF LOCATION TO RECEIVE DSW CONTENTS
	BEQ	10$		; IF EQ DSW NOT RETURNED
	MOV	@#$DSW,(R0)	; ELSE RETURN STATUS
10$:				;
	RETURN			;

	.END
