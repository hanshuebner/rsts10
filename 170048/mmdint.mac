	.INCLUDE /CMN:COMMON/
	.INCLUDE /CMN:KERNEL/
	.INCLUDE /CMN:MTDEF/
TITLE	MMDINT,<Massbus Magtape Root Code>,0A,10-MAY-91,KPH/DBM

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR MMDINT

;+
;
;  000	KPH  11-Sep-84	Creation - Copied from thin air
;  001	DBM  01-Jun-85	Include ERLDVR here instead of driver
;-

	INCLUDE	ERLDVR							;001

	DEFORG	MMDVR

	DEFORG	MMDCTL

	DEFORG	MMDINT

	TMPORG	BGBUFR

BGBUFR:	.BLKB	MTULBF		;EXTEND THE BIG BUFFER TO CORRECT SIZE

	TMPORG	BUFCTL,10

	.WORD	1		;SAY THAT 1 BIG BUFFER EXISTS

.SBTTL	MAGTAPE DRIVER DEFINITIONS

STS.MM	==	0/400
		;NO SPECIAL FLAGS

FLG.MM	==	MTAHND
		;MAGTAPE

SIZ.MM	==	5*14.+1
		;DEFAULT FOR "NO WIDTH"

BUF.MM	==	512.
		;DEFAULT BUFFER IS 512. BYTES

; MAGTAPE OPEN/CLOSE ARE NON-RESIDENT

OPN$MM	==	-4+1
CLS$MM	==	-4+1

.SBTTL	MAGTAPE DIRTY (READ/WRITE) AREA

	TMPORG	MMDCTL

MMAQUE::.WORD	0	;REQUEST QUEUE
MMARWQ::.WORD	0	;REQUEST, BUT DRIVE REWINDING, QUEUE

MMGFUN::.BYTE	0	;RH11 FUNCTION AT "GO" TIME
	.EVEN

; Note: The following 5 items are grouped

MMASCT::.BYTE	0	;HOW MANY TO SKIP IN REWIND QUEUE
MMADRW::.BYTE	0	;SHOULD WE BE DOING REWIND CHECKING?
MMAINF::.BYTE	0	;FLAGS...
MMATIM::.BYTE	0	;TIME OUT COUNTER
MMASFC::.WORD	0	;CURRENT "MMFC" FOR TIMEOUT CHECKING

	TMPORG	MMDINT

MMDINT:	CALLX	INTSAV,R5
	  .WORD	1200		;Actual APR5 value filled in
	  .WORD	0		;Entry for interrupt service filled in

ERL$MM::JMP	@#0		;Entry for error logging filled in

SER$MM::JMP	@#0		;Entry for user level service filled in

TMO$MM::JMP	@#0		;Entry for timeouts filled in

SPC$MM::JMP	@#0		;Entry for special functions filled in

ASN$MM::JMP	@#0		;Entry for assignment filled in

DEA$MM::JMP	@#0		;Entry for deassignment filled in

CON$MM::JMP	@#0		;Entry to continuation service filled in

DNE$MM::JMP	@#0		;Entry to done service filled in

UMR$MM::JMP	@#0		;Entry to UMR service filled in

.SBTTL	MAGTAPE PURE (READ-ONLY) DATA

	TMPORG	MMDTBL

MMAPTR::.WORD	MMAQUE	;POINTER TO THE QUEUE ROOT
MML3QB::.L3Q	QMMCON	;LEVEL 3 QUEUE BIT TO SET

.END
