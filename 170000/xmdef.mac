TITLE	XMDEF,<DMC-11 DEFINITIONS>,0A,10-MAY-91,ABC/JDM/RTW

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR XMDEF
;+
;
;  000  RRF  06-MAR-81	CREATION - COPIED FROM V7.0-07
;
;-

.SBTTL	DMC-11 DDB DEFINITIONS

; DMC DEVICE DATA BLOCK (DDB) DEFINITIONS
 
.DSECT
 
; THE FOLLOWING ENTRIES ARE REQUIRED TO BE IN ALL DDB'S
 
DDIDX:	.BLKB			;DRIVER INDEX
DDSTS:	.BLKB			;STATUS AND ACCESS CONTROL BYTE
DDJBNO:	.BLKB			;OWNER JOB NUMBER TIMES 2(0 TO N)
DDUNT:	.BLKB			;DEVICE UNIT NUMBER TIMES 1 (0 TO N)
DDTIME:	.BLKW			;TIME ASSIGNED OR INITED
DDCNT:	.BLKW			;INIT COUNT AND ASSIGNMENT CONTROL
 
; THE FOLLOWING ENTRIES ARE SPECIFIC TO THE DMC-11
 
DDFLAG:	.BLKW			;DEVICE DEPENDENT FLAGS
XMBSIZ:	.BLKW			;RECEIVE BUFFER SIZE FOR THIS LINE
XMSECA:	.BLKB			;SECONDARY STATION ADDRESS (NOT USED NOW)
XMMODE:	.BLKB			;OPERATIONAL MODE (BIT DEFINITIONS BELOW)
XMDDB2:	.BLKW			;POINTER TO DDB QUEUE BLOCK EXTENSION
XMCTBL:	.BLKW			;CORE TABLE ADDRESS (ABSOLUTE OR CONTORTED)
XMRBUF:	.BLKW			;RECV BUFFER WAITING FOR CCB
XMBSQB:	.BLKW	2		;BUFFER STALL QUEUE
XMBL3Q:	.BLKW			;POINTER TO XMBSQP FOR QUEL3Q
XMBQTA:	.BLKB			;QUOTA OF RECEIVE BUFFERS REQUIRED
XMTIMR:	.BLKB			;NUMBER OF SECONDS FOR TRANS TIME OUTS
XMNOB:	.BLKW			;POINTER TO NSP NODE BLOCK (NSP USE ONLY)
XMCTLO:	.BLKW			;SEL6 VALUE FROM CONTROL OUT
XMECTR:	.BLKW	3		;COUNTERS FOR NON-FATAL DMC ERRORS
XMFLG2:	.BLKW	1		;SECOND WORD OF FLAGS
	.BLKW	4		;RESERVED

XMDDSZ:				;SIZE OF DDB

; DMC DDB QUEUE BLOCK EXTENSION

.DSECT
 
X2TIPQ:	.BLKW	2		;XMIT IN PROGRESS QUEUE - GIVEN TO DMC
X2RIPQ:	.BLKW	2		;REC  IN PROGRESS QUEUE - GIVEN TO DMC
X2TQUE:	.BLKW	2		;TRANSMIT PENDING QUEUE - NOT YET GIVEN TO DMC
X2RQUE:	.BLKW	2		;RECEIVE PENDING QUEUE  - NOT YET GIVEN TO DMC
X2RCPQ:	.BLKW	2		;REC  COMPLETE QUEUE    - NON NSP USE
X2CPLQ:	.BLKW	2		;COMPLETION QUEUE
X2QEND:				;END OF QUEUES
X2TCNT:	.BLKB			;NUMBER OF TRANSMIT BUFFERS GIVEN TO DMC
X2NXMT:	.BLKB			;TOTAL NUMBER OF BUFFERS PENDING ON XMIT SIDE
X2NRCP:	.BLKB			;NUMBER OF BUFFERS ON USER RCV COMPLETE QUEUE
	.BLKB			;RESERVED
X2RCNT:	.BLKB			;NUMBER OF RECEIVE BUFFERS GIVEN TO DMC
X2NRCV:	.BLKB			;TOTAL NUMBER OF BUFFERS ASSIGNED TO RECEIVE
X2MSIZ:	.BLKW			;SIZE OF FIRST MESSAGE ON RECEIVE QUEUE

.IIF NE	.-40,	.ERROR		;DDB EXTENSION TOO BIG
  
; CHECK ORDERING REQUIREMENTS
.IIF NE XMBSQB+4-XMBL3Q,	.ERROR	;INVALID DDB
.IIF NE XMBQTA&1,		.ERROR	;INVALID DDB
.IIF NE X2TIPQ+4-X2RIPQ,	.ERROR	;INVALID DDB
.IIF NE X2TQUE+4-X2RQUE,	.ERROR	;INVALID DDB
.IIF NE <X2TQUE-X2TIPQ>-<X2RQUE-X2RIPQ>, .ERROR ;INVALID DDB
.IIF NE <X2RCNT-X2TCNT>-<X2RQUE-X2TQUE>, .ERROR ;INVALID DDB
.IIF NE <X2NRCV-X2NXMT>-<X2RQUE-X2TQUE>, .ERROR ;INVALID DDB
.IIF NE X2TIPQ,			.ERROR	;INVALID DDB

; BITS DEFINED IN DDFLAG

.DSECT	377

	.BLKB	1	;MOST RECENT DMC11 FATAL ERROR CODE
	.BLKB	.	;RESEVERED
XM.SUP:	.BLKB	.	;DMC11 WAITING FOR DSR TO GIVE BASE TABLE
XM.FXC:	.BLKB	.	;FIRST TRANSFER COMPLETE
XM.FLS:	.BLKB	.	;USER WAITING FOR OUTPUT QUEUES TO EMPTY
XM.WAT:	.BLKB	.	;USER WAITING FOR INPUT BUFFER
XM.ERR:	.BLKB	.	;REQUEST L3 POSTING OF ERROR TO NSP
XM.STL:	.BLKB	.	;STALLED FOR BUFFERS
DDSTAT:	.BLKB	.	;DEVICE DISABLED IF ZERO

; BITS DEFINED IN XMFLG2

.DSECT	377

	.BLKB	1	;RESEVERED
XM.DS1:	.BLKB	.	;DSR HIGH ON LAST TIMEOUT.
XM.DSR:	.BLKB	.	;DSR ON FOR AT LEAST ONE FULL SECOND.
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED

; ERROR CODES IN LOW BYTE OF DDFLAG

.DSECT	-1

ER.TMO:	.BLKB		;TIME OUT WITH XMIT PENDING
ER.DMC:	.BLKB		;DMC11 HARDWARE ERROR
ER.UNK:	.BLKB		;UNKNOWN CTLO INTERRUPT
ER.III:	.BLKB		;ILLEGAL INPUT INTERRUPT
ER.IOI:	.BLKB		;ILLEGAL OUTPUT INTERRUPT
ER.UII:	.BLKB		;UNSOLICITED INPUT INTERRUPT
ER.UOI:	.BLKB		;UNEXPECTED OUTPUT INTERRUPT
ER.MRC:	.BLKB		;DDCMP MAINTENANCE MESSAGE RECEIVED
ER.LSD:	.BLKB		;LOST DATA ERROR
	.BLKB		;RESERVED
ER.DIS:	.BLKB		;DISCONNECT ON LINE
ER.STR:	.BLKB		;DDCMP START RECEIVED
ER.NEM:	.BLKB		;UNIBUS ADDRESS TIMEOUT ON DMC ACCESS
ER.PRO:	.BLKB		;PROCEDURE ERROR 

; BITS DEFINED IN XMMODE

.BSECT	HIGH
 
XM.MNT:	.BLKB	.	;DDCMP MAINTAINTENANCE MODE
XM.HOS:	.BLKB	.	;HANG-UP ON RECEIVING A START IF SET
XM.HDX:	.BLKB	.	;HALF DUPLEX OPERATION IF SET
XM.SEC:	.BLKB	.	;HALF DUPLEX SECONDARY STATION IF SET
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
XM.LUL:	.BLKB	.	;LINE UNIT LOOP BACK
	.BLKB	.	;RESERVED

.SBTTL	COMMUNICATION CONTROL BLOCK (CCB) DEFINITIONS

.DSECT

CC.LNK:	.BLKW		;LINK TO NEXT CCB IN SOME LIST
CC.WAK:	.BLKW		;NSP TRANSMIT QUE LINK (WAITING FOR ACK)
CC.FC:	.BLKB		;FUNCTION CODE (SEE DEFINITIONS BELOW)
CC.DFL:	.BLKB		;DEVICE/BUFFER DISPOSITION FLAGS
CC.FLG:	.BLKW		;MSGFLGS FIELD VALUE
CC.RIB:	.BLKW		;RECEIVER ID BLOCK POINTER
CC.FCV:			;FLOW CONTROL VALUE FOR LS MESSAGE
CC.DDB:	.BLKW		;DMC DDB ADDRESS FOR DMC FUNCTIONS
CC.AKN:			;ACKNUM FROM RECEIVED MESSAGES
CC.FQB:	.BLKW		;PTR TO FIRQB ON USER SYNCHRONOUS CALLS
CC.SGN:	.BLKW		;SEGNUM FOR CHECKING ACKNOWLEDGEMENTS
CC.SEC:	.BLKW	4	;SECONDARY BUFFER DESCRIPTOR
CC.BUF:	.BLKW	4	;PRIMARY BUFFER DESCRIPTOR

; LAYOUT OF BUFFER DESCRIPTORS (CC.BUF AND CC.SEC)

.DSECT

BF.ADR:	.BLKW		;BUFFER ADDRESS (RSTS SHIFTED MMU FORMAT)
BF.VIR:	.BLKW		;BUFFER ADDRESS (VIRTUAL)
BF.MMU:	.BLKW		;KISAR6 VALUE FOR THIS BUFFER
BF.END:			;END OF MESSAGE (VIRTUAL)
MS.SIZ:	.BLKW		;MESSAGE SIZE IN BYTES

; DMC-11 CCB DEFINITIONS (OVERLAYS SECONDARY BUFFER DESCRIPTOR)

.DSECT	CC.SEC

CC.XBA:	.BLKW		;UNIBUS ADDRESS<15:0>
CC.XBC:	.BLKW		;CC.XBC<15:14> = UNIBUS ADDRESS<17:16>
			;CC.XBC<13:0>  = CHARACTER COUNT

; DEVICE/BUFFER DISPOSITION FLAGS (CC.DFL)

.BSECT
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DF.NYS:	.BLKB	.	;NOT YET SENT (DRIVER CONTROLLED)
DF.RXM:	.BLKB	.	;MESSAGE NEEDS TO BE RETRANSMITTED 
DF.WAK:	.BLKB	.	;WAITING FOR NSP ACKNOWLEDGEMENT

.SBTTL	CCB FUNCTION CODE (CC.FC) DEFINITIONS

; USER FUNCTIONS (USER -> NSP)

.DSECT

FC$BAD:	.BLKW		;ILLEGAL FUNCTION
FC$REM:	.BLKW		;NSP  REMOVE ALL LINKS (IMMEDIATELY)
FC$DCL:	.BLKW		;RECEIVER DECLARATION
FC$RCV:	.BLKW		;USER RECEIVE
FC$UCI:	.BLKW		;USER CONNECT INITIATE
FC$UCC:	.BLKW		;USER CONNECT CONFIRM
FC$UCR:	.BLKW		;USER CONNECT REJECT
FC$UDM:	.BLKW		;USER DATA MESSAGE
FC$INT:	.BLKW		;USER INTERRUPT
FC$ULS:	.BLKW		;USER LINK STATUS
FC$DIS:	.BLKW		;USER DISCONNECT
FC$ABT:	.BLKW		;USER ABORT LOGICAL LINK
FC$GLT:	.BLKW		;GET NSP/LLT INFORMATION

; FUNCTION CODES RETURNED BY DMC-11 DRIVER

FC$RCP:	.BLKW		;RECEIVE COMPLETE - DATA MESSAGE RECEIVED
FC$ERR:	.BLKW		;ERROR DETECTED
FC$IDL:	.BLKW		;DMC IDLE (NSP NOP REQUIRED TO CHECK LINE)

; NSP FUNCTIONS (NSP -> DMC-11)

.DSECT

XM$INI:	.BLKW		;INITIALIZE PHYSICAL LINE
XM$KIL:	.BLKW		;KILL THIS PHYSICAL LINE
XM$XMT:	.BLKW		;TRANSMIT THIS MESSAGE

.SBTTL	MISCELLANEOUS DEFINITIONS

.EQUATE	NSPJOB,	3	;DUMMY NSP JOB NUMBER

; STANDARD BUFFER HEADER FORMAT

.DSECT

BF.SIZ:	.BLKW		;SIZE OF THIS BUFFER IN BYTES
BF.OFF:	.BLKW		;OFFSET TO START OF DATA
BF.LNK:	.BLKW		;LINK TO NEXT BUFFER IN CHAIN
BF.CNT:	.BLKW		;BYTE COUNT FOR DATA IN THIS BUFFER

BUFHDR:			;SIZE OF BUFFER HEADER

