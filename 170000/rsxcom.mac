TITLE	RSXCOM,<RSX EMULATION COMMON DEFINITIONS>,0A,10-MAY-91,SSS/MJG/MHB/DWF/WRM

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR RSXCOM
;+
;
;  000  RRF  06-MAR-81	CREATION - COPIED FROM V7.0-07
;
;			[RSTS V9.4]
;  001	DWF  24-Feb-87	Add WS.SIS definition
;  002  WRM  07-Apr-88	Add WS.UDS definition
;
;			[RSTS V9.7]
;  003  WRM  14-Dec-88	Add supervisor mode flags
;			Fix overlay flag
;
;-

.SBTTL	JOB UNIQUE LOW MEMORY LAYOUT DURING RSX EMULATION

.DSECT

R.TSKN:	.BLKW	2	;TASK NAME IN RAD50
R.PRTN:	.BLKW	2	;PARTITION NAME IN RAD50
R.CDSZ:	.BLKW		;TASK SIZE (W/O EXTENSION) IN 32-WORD BLOCKS
R.ODTV:	.BLKW		;ODT SST VECTOR ADDRESS	(see note 1)		;003
R.ODTL:	.BLKB		;ODT SST VECTOR LENGTH
	.EVEN
R.SSTV:	.BLKW		;TASK SST VECTOR ADDRESS(see note 1)		;003
R.SSTL:	.BLKB		;TASK SST VECTOR LENGTH
	.EVEN
R.FAST:	.BLKW		;FPP AST SERVICE ADDRESS	(see note 2)	;003
R.CAST:	.BLKW		;CTRL/C AST SERVICE ADDRESS	(see note 2)	;003
R.TSKF:	.BLKW		;TASK FLAGS
R.PARM:	.BLKW		;RUN PARAMETER ON ENTRY (FROM FIRQB+FQNENT)
R.CCLF:	.BLKW		;CCL ENTRY FLAGS, RUN SIZE/EXTENSION (FROM XRB+0)
R.LDSZ:	.BLKW		;LOAD SIZE OF TASK IN 32-WORD BLOCKS
R.TKSZ:	.BLKW		;CURRENT SIZE OF TASK IN 32-WORD BLOCKS
R.NLUN:	.BLKW		;NUMBER OF LUNS

R.MON1:	.BLKW		;MONITOR RSX EMULATION RESERVED WORD #1
R.MON2:	.BLKW		;MONITOR RSX EMULATION RESERVED WORD #2

$DSW:	.BLKW		;DIRECTIVE STATUS WORD
.FSRPT:	.BLKW		;FCS IMPURE AREA POINTER
$OTSV:	.BLKW		;OTS IMPURE AREA POINTER
N.OVPT:	.BLKW		;AUTO-LOAD IMPURE AREA POINTER
$VEXT:	.BLKW		;EXTENDED IMPURE AREA POINTER

CONTXT:	.BLKW	15	;RESERVED FOR MONITOR CONTEXT USE
FPPTXT:	.BLKW	6*4	;RESERVED FOR MONITOR FPP CONTEXT USE
R.HDRZ:	.BLKW		;SIZE OF TASK HEADER AREA IN TASK FILE (FOR OVERLAY)
	.BLKB	200-.	;RESERVED

R.LUNS:	.BLKW	16.*4	;LUN TABLE

USRSP:			;DEFAULT (INITIAL) JOB SP STACK SETTING
KEY:	.BLKW		;KEYWORD OF JOB'S CURRENT STATUS
FIRQB:	.BLKB	FQBSIZ	;FILE REQUEST QUEUE BLOCK
XRB:	.BLKB	XRBSIZ	;TRANSFER CONTROL BLOCK
CORCMN:	.BLKB	200	;CCL LINE COMMON

PMDSP:	.BLKW		;SP SAVED HERE ON A POST-MORTEM DUMP
PMDXRB:	.BLKB	XRBSIZ	;XRB SAVED HERE ON A POST-MORTEM DUMP
	.BLKB	FQBSIZ-XRBSIZ ;FIRQB ALSO SAVED STARTING AT "PMDXRB"
			;** NOTE - BP2 RTS SAVES FIRQB HERE FOR SYS(12) **

	.BLKB	734-.	;SP STACK SPACE USED BY RSX RTS DURING PROGRAM LOADING

USRPPN:	.BLKW		;USER'S ASSIGNABLE PPN
USRPRT:	.BLKW		;USER'S ASSIGNABLE PROTECTION CODE
USRLOG:	.BLKW	4*4	;USER'S LOGICAL DEVICE TABLE
NSTORG:	.BLKW		;STACK GUARD WORD - MUST REMAIN 0

	;Note 1		On these address cells bit 0 represents the mode ;003
	;		(user or supervisor) that the respective AST trap ;003
	;		request was issued from, (0=user & 1=Super)	  ;003

	;Note 2		On these address cells bit 0 represents the mode ;003
	;		where the respective AST service routine lives	 ;003
	;		In these cases the source mode is indicated in   ;003
	;		KEY cell as status bits, again 0=user, 1=super.  ;003

.SBTTL	JOB UNIQUE KEYWORD BIT DEFINITIONS DURING RSX EMULATION

.BSECT			;IN "KEY"

	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
JFCAST:	.BLKB	.	;^C AST MODE AT REQUEST (0=USER/1=SUPER)	;003
JFFAST:	.BLKB	.	;FPA AST MODE AT REQUEST (0=USER/1=SUPER)	;003
JFOVLY:	.BLKB	.	;TASK IS OVERLAID				;003
JFSTAY:	.BLKB	.	;EXIT TO MONITOR WITH NO PROMPT IF ON
JFDUMP:	.BLKB	.	;USER WANTS POST-MORTEM DUMP IF ON
JFTRAP:	.BLKB	.	;USER CAN TRAP AST'S AND SST'S IF ON
JFSPRI:	.BLKB	.	;JOB IS AT SPECIAL RUN PRIORITY
JFFPP:	.BLKB	.	;SAVE/RESTORE ASYNC FPP CONTEXT
JFPRIV:	.BLKB	.	;JOB HAS PERMANENT PRIV'S
JFSYS:	.BLKB	.	;JOB HAS TEMPORARY PRIV'S ACTIVE
JFNOPR:	.BLKB	.	;JOB IS NOT YET LOGGED IN
JFBIG:	.BLKB	.	;JOB CAN EXCEED ITS PRIVATE MEMORY MAX
JFLOCK:	.BLKB	.	;JOB IS NOT TO BE SWAPPED
JFKEEP:	.BLKB	.	;PRESERVE JOB IMAGE IF ON

.SBTTL	RSX DEVICE CHARACTERISTICS BITS

.BSECT			;IN "R.LUNS" TABLE, EACH ENTRY'S WORD 3 OF 4

FD.REC:	.BLKB	.	;RECORD ORIENTED DEVICE
FD.CCL:	.BLKB	.	;CARRIAGE CONTROL DEVICE
FD.TTY:	.BLKB	.	;TERMINAL DEVICE
FD.DIR:	.BLKB	.	;DIRECTORY DEVICE
FD.SDI:	.BLKB	.	;SINGLE DIRECTORY DEVICE
FD.SQD:	.BLKB	.	;SEQUENTIAL DEVICE
	.BLKB	.	;UNUSED BY US...
	.BLKB	.	;UNUSED BY US...
	.BLKB	.	;UNUSED BY US...
	.BLKB	.	;UNUSED BY US...
	.BLKB	.	;UNUSED BY US...
	.BLKB	.	;UNUSED BY US...
	.BLKB	.	;UNUSED BY US...
	.BLKB	.	;UNUSED BY US...
	.BLKB	.	;UNUSED BY US...
	.BLKB	.	;UNUSED BY US...

.SBTTL	RSX PLAS DEFINITIONS

.DSECT			;REGION DEFINITION BLOCK (RDB)

R.GID:	.BLKW		;REGION ID
R.GSIZ:	.BLKW		;REGION SIZE IN 32-WORD BLOCKS
R.GNAM:	.BLKW	2	;REGION NAME IN RAD50
R.GPAR:	.BLKW	2	;REGION PARTITION NAME IN RAD50
R.GSTS:	.BLKW		;REGION STATUS
R.GPRO:	.BLKW		;REGION PROTECTION

.BSECT			;REGION STATUS BITS (IN "R.GSTS")

RS.RED:	.BLKB	.	;READ ACCESS DESIRED ON ATTACH
RS.WRT:	.BLKB	.	;WRITE ACCESS DESIRED ON ATTACH
RS.EXT:	.BLKB	.	;EXTEND ACCESS DESIRED ON ATTACH
RS.DEL:	.BLKB	.	;DELETE ACCESS DESIRED ON ATTACH
RS.NEX:	.BLKB	.	;CREATED REGION IS NOT EXTENDABLE
RS.ATT:	.BLKB	.	;ATTACH TO CREATED REGION
RS.NDL:	.BLKB	.	;CREATED REGION NOT TO BE DELETED ON LAST DETACH
RS.MDL:	.BLKB	.	;MARK REGION FOR DELETE ON LAST DETACH
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
RS.UNM:	.BLKB	.	;AT LEAST ONE WINDOW WAS UNMAPPED ON A DETACH
RS.CRR:	.BLKB	.	;REGION WAS SUCCESSFULLY CREATED

.DSECT			;WINDOW DEFINITION BLOCK (WDB)

W.NID:	.BLKB		;WINDOW ID
W.NAPR:	.BLKB		;WINDOW BASE APR
W.NBAS:	.BLKW		;WINDOW BASE VIRTUAL ADDRESS
W.NSIZ:	.BLKW		;WINDOW SIZE IN 32-WORD BLOCKS
W.NRID:	.BLKW		;WINDOW'S REGION ID
W.NOFF:	.BLKW		;OFFSET INTO REGION IN 32-WORD BLOCKS
W.NLEN:	.BLKW		;MAP LENGTH IN 32-WORD BLOCKS
W.NSTS:	.BLKW		;WINDOW STATUS
W.NSRB:	.BLKW		;SEND/RECEIVE BUFFER ADDRESS

.BSECT			;WINDOW STATUS BITS (IN "W.NSTS")

WS.RED:	.BLKB	.	;SEND WITH READ ACCESS
WS.WRT:	.BLKB	.	;SEND WITH WRITE ACCESS
WS.EXT:	.BLKB	.	;SEND WITH EXTEND ACCESS
WS.DEL:	.BLKB	.	;SEND WITH DELETE ACCESS
WS.UDS:	.BLKB	.	;User Data only mode (D-space) access		;002
WS.SIS:	.BLKB	.	;Supervisor mode (I-space) access		;001
WS.RCX:	.BLKB	.	;EXIT IF NO REFERENCE TO RECEIVE
WS.MAP:	.BLKB	.	;MAP WINDOW IN CRAW$
WS.64B:	.BLKB	.	;ALLOW 32-WORD ALIGNMENT
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
WS.REF:	.BLKB	.	;REFERENCE WAS SUCCESSFULLY RECEIVED
WS.ELW:	.BLKB	.	;AT LEAST ONE WINDOW WAS ELIMINATED BY...
WS.UNM:	.BLKB	.	;AT LEAST ONE WINDOW WAS UNMAPPED BY...
WS.CRW:	.BLKB	.	;ADDRESS WINDOW WAS SUCCESSFULLY CREATED


