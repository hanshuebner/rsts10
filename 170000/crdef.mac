TITLE	CRDEF,<CARD READER DEFINITIONS>,0A,10-MAY-91,MHB/GW

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR CRDEF
;+
;
;  000  RRF  06-MAR-81	CREATION - COPIED FROM V7.0-07
;
;-

.SBTTL	CARD READER DDB LAYOUT

.DSECT

DDIDX:	.BLKB		;DRIVER INDEX [IDX.CR OR IDX.CD]
DDSTS:	.BLKB		;STATUS AND ACCESS CONTROL BYTE
DDJBNO:	.BLKB		;OWNER JOB NUMBER TIMES 2 (0 IF FREE)
DDUNT:	.BLKB		;DEVICE UNIT NUMBER
DDTIME:	.BLKW		;TIME ASSIGNED OR INITED
DDCNT:	.BLKW		;INIT COUNT AND ASSIGNMENT CONTROL
DDFLAG:	.BLKW		;DEVICE DEPENDENT FLAGS
CDRPTR:	.BLKW		;POINTER INTO READER BUFFER
CDRBFE:	.BLKW		;END OF BUFFER POINTER
CDRBUF:	.BLKW		;POINTER TO READER BUFFER
	.BLKW	80.	;ROOM FOR 80. CARD COLUMNS
	.BLKW		;SPACE FOR TRAILING CR/LF

; BIT ASSIGNMENTS FOR CARD READER DDB STATUS WORDS ARE AS FOLLOWS:

.BSECT	HIGH		;IN DDSTS (AS A WORD)

DDPRVO:	.BLKB	.	;OWNERSHIP REQUIRES PRIV'S
DDRLO:	.BLKB	.	;READ LOCK FOR DEVICE IF SET [0]
DDWLO:	.BLKB	.	;WRITE-LOCK FOR DEVICE IF SET [1]
DDNET:	.BLKB	.	;NETWORK DEVICE
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DDSTAT:	.BLKB	.	;FIRST TIME THROUGH FLAG

.BSECT	HIGH		;IN DDCNT (AS A WORD)

	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DDCONS:	.BLKB	.	;DEVICE IS THE CONSOLE DEVICE
DDUTIL:	.BLKB	.	;DEVICE ASSIGNED FOR UTILTY SEQUENCE
DDASN:	.BLKB	.	;DEVICE ASSIGNED THROUGH COMMAND

.DSECT	377		;IN DDFLAG [ERROR CODE AND STATUS]

CDRERR:	.BLKB	1001	;ERROR CODE FROM INTERRUPT SERVICE
CDRMOD:	.BLKB	400	;CURRENT DEFAULT MODE
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
CDRBSY:	.BLKB	.	;READER CURRENTLY BUSY
CDRTRN:	.BLKB	.	;DATA IS TRANSLATED IN BUFFER
CDRNDT:	.BLKB	.	;NO DATA IN BUFFER

.DSECT			;MODE CODES

MDASCI:	.BLKB		;TRANSLATE COLUMNS TO ASCII CODES
MDHOLI:	.BLKB		;TRANSLATE COLUMNS TO PACKED HOLLIRITH
MDBINC:	.BLKB		;TRANSLATE COLUMNS TO 12 BITS (IN 2 BYTES)

.SBTTL	CARD READER HARDWARE DEFINITIONS

; REGISTER OFFSETS FOR CR11

.DSECT

	.BLKW		;READER STATUS
CRB:	.BLKW		;CARD READER BUFFER

; REGISTER OFFSETS FOR CD11

.DSECT

	.BLKW		;CONTROL STATUS
CDCC:	.BLKW		;COLUMN COUNTER
CDBA:	.BLKW		;BUS ADDRESS
CDBB:	.BLKW		;DATA BUFFER

; CONTROLLER STATUS BITS FOR CR11

.DSECT	400

CROFFL:	.BLKB	177400	;OFF-LINE INDICATION

; CONTROLLER STATUS BITS FOR CD11

.DSECT	4

CDHPCK:	.BLKB	374	;HOPPER CHECK
CDPCLR:	.BLKB	6400	;CONTROLLER POWER CLEAR
CDBADE:	.BLKB	171000	;BAD ERRORS (NXM, DATA LATE, DATA ERROR)

; DATA BUFFER BIT ASSIGNMENTS

.DSECT	40000

CDRDCK:	.BLKB	.	;READ CHECK
	.BLKB	.	;ECO INSTALLED

