TITLE	MTDEF,<COMMON MAGTAPE DEFINITIONS>,0A,10-MAY-91,MHB/SJK/JHC/DBM/KPH/VAM

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR MTDEF
;+
;
;  000  RRF  06-MAR-81	CREATION - COPIED FROM V7.0-07
;
;	  		[RSTS V9.0]
;  001  JHC  14-Dec-83	Added TSQ definitions.
;  002	DBM  02-May-84	Add MT.ECK bit in MTFLAG
;  003	DBM  26-Oct-84	Add TSQSTS bit assignments
;  004	KPH  04-Jan-85	Add density sensing flag bits
;  005  VAM  28-Feb-85	Add XDN.MT SPEC function
;
;			[RSTS Vx.x]
;  006	DBM  10-Dec-85	Add TSQJOB, move TSQMTO
;
;			[RSTS V9.3]
;  007  VAM  07-Aug-86	Add MUTYP (equated to MTTM02).
;			Also, change comments on MTTM02 to explain all of this.
;
;-

; COMMON MAGTAPE DEFINITIONS

.EQUATE	MTRTCT,	-15.	;INITIAL RETRY COUNT (MTRTRY) VALUE

.EQUATE	MTDDSP,	14	;NORMAL OFFSET INTO A MAGTAPE DDB

; MAGTAPE DDB LAYOUT

.DSECT	-MTDDSP

MTIDX:	.BLKB		;DRIVER INDEX		[DDIDX]
MTSTS:	.BLKB		;STATUS BYTE		[DDSTS]
MTJBNO:	.BLKB		;OWNING JOB NUMBER	[DDJBNO]
MTDUNI:	.BLKB		;UNIT NUMBER		[DDUNT]
MTTIME:	.BLKW		;TIME OF OWNERSHIP	[DDTIME]
MTDDCT:	.BLKW		;ACCESS CONTROL		[DDCNT]
MTFLAG:	.BLKB		;FLAGS			[DDFLAG]
MTTM02:	.BLKB		;TM02 unit number for TE16/TU16/TU45, or drive	;007
			; type for TS11/TSV05 and TMSCP drives.		;007
MTCRET:	.BLKW		;COMPLETION RETURN VALUE
MTQPTR:	.BLKW		;DRIVER QUEUE LINK WORD
MTQRET:	.BLKW		;RETURN ADDRESS TO DRIVER
MTRPTR:	.BLKW		;POINTER FOR QUEUEING REQUESTS
MTUBUF:	.BLKW		;USER'S VIRTUAL BUFFER ADDRESS
MTCNT:	.BLKW		;BYTE/RECORD COUNT
MTOFLG:	.BLKB		;OPEN FLAG
MTLCEV:	.BLKB		;LAST COMMAND EXIT VALUE
MTRTRY:	.BLKB		;RETRY COUNTER
MTLBLI:	.BLKB		;DOS(0)/ANSI(-1) LABEL INDICATOR
MTCCMD:	.BLKB		;CURRENT COMMAND
MTLCMD:	.BLKB		;LAST COMMAND
MTLCST:	.BLKW		;LAST COMMAND STATUS
MTBCNT:	.BLKW		;'MTU' RETURN ADDR & BLOCK/RECORD COUNTER
MTACB:	.BLKW		;POINTER FOR ANSI FILE CONTROL BLOCK
MTJIOB:	.BLKW		;POINTER TO JOB'S IOB SLOT
MTFQB:	.BLKW		;POINTER TO FIRQB

; Asynchronous and TS11 specific definitions

.EQUATE	MSTYP,MTTM02	; the TS11 device type byte
.EQUATE	MUTYP,MTTM02	; Same thing for TMSCP drives.			;007
.EQUATE	MTUTSQ,MTUBUF	; MTU return TSQ pointer

; VERIFY CORRECT DDB LAYOUT

.ASSUME	<MTIDX+MTDDSP>	EQ	DDIDX
.ASSUME	<MTSTS+MTDDSP>	EQ	DDSTS
.ASSUME	<MTJBNO+MTDDSP>	EQ	DDJBNO
.ASSUME	<MTDUNI+MTDDSP>	EQ	DDUNT
.ASSUME	<MTTIME+MTDDSP>	EQ	DDTIME
.ASSUME	<MTDDCT+MTDDSP>	EQ	DDCNT
.ASSUME	<MTFLAG+MTDDSP>	EQ	DDFLAG

.ASSUME	MTQPTR		EQ	0
.ASSUME	<MTRPTR-MTQPTR>	EQ	DSQL3Q

.ASSUME	MTQRET		EQ	BGQRET
.ASSUME	MTUBUF		EQ	BGBUFF

.BSECT	HIGH		;IN MTSTS(DDSTS) (AS A WORD)

DDPRVO:	.BLKB	.	;OWNERSHIP REQUIRES PRIV'S
DDRLO:	.BLKB	.	;READ LOCK FOR DEVICE IF SET [1]
DDWLO:	.BLKB	.	;WRITE-LOCK FOR DEVICE IF SET [0]
DDNET:	.BLKB	.	;NETWORK DEVICE
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DDSTAT:	.BLKB	.	;DENSITY/PARITY DEFAULTS NEED SETTING

.BSECT	HIGH		;IN MTDDCT(DDCNT) (AS A WORD)

	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DDCONS:	.BLKB	.	;DEVICE IS THE CONSOLE DEVICE
DDUTIL:	.BLKB	.	;DEVICE ASSIGNED FOR UTILTY SEQUENCE
DDASN:	.BLKB	.	;DEVICE ASSIGNED THROUGH COMMAND

.BSECT			;IN MTFLAG(DDFLAG)

MT.NRW:	.BLKB	.	;NO REWIND ON CLOSE
MT.ECK:	.BLKB	.	; error check in progress on this unit
MT.LEO:	.BLKB	.	; LEOT detected during error check
MT.PAR:	.BLKB	.	;DEFAULT PARITY SETTING
MT.ADR:	.BLKB	120	;Do automatic density recognition for this read	;004
MT.DEN:	.BLKB	40	;DEFAULT DENSITY SETTING
MT.ADS:	.BLKB	.	;Set default density at end of request		;004

.DSECT	7		;IN MTOFLG

MT.UNT:	.BLKB	1	;UNIT NUMBER
MT.PAR:	.BLKB	.	;1=>EVEN PARITY; 0=>ODD PARITY
MT.OPN:	.BLKB	120	;OPEN FLAG
MT.DEN:	.BLKB	177440	;DENSITY SETTING
MT.FS:	.BLKB	200	;FILE STRUCTURED FLAG

.DSECT			;COMMANDS IN MTCCMD

RWO.MT:	.BLKB		;REWIND THEN OFFLINE
RED.MT:	.BLKB		;READ
WRT.MT:	.BLKB		;WRITE
EOF.MT:	.BLKB		;WRITE END-OF-FILE (TAPE MARK)
REW.MT:	.BLKB		;REWIND
SKP.MT:	.BLKB		;SKIP(SPACE) FORWARD
BSP.MT:	.BLKB		;SKIP(SPACE) BACKWARD
DEN.MT:	.BLKB		;SET DENSITY/PARITY
UNT.MT:	.BLKB		;RETURN UNIT STATUS
FIL.MT:	.BLKB		;RETURN FILE CHARACTERISTICS
RWC.MT:	.BLKB		;REWIND ON CLOSE
EOV.MT:	.BLKB		; end of volume spec.
ECA.MT:	.BLKB		; error condition acknowledged			;???
XDN.MT:	.BLKB		;Extended Set Density				;005
GBF.MT:	.BLKB		;GET ANSI LABEL BUFFER

.BSECT			;IN MTLCST

	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
MTRLE:	.BLKB	.	;RECORD LENGTH ERROR
MTEOT:	.BLKB	.	;END OF TAPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
	.BLKB	.	;UNIQUE TO DEVICE TYPE
MTEOF:	.BLKB	.	;AT EOF (TAPE MARK)
	.BLKB	.	;UNIQUE TO DEVICE TYPE

.EQUATE	DOSLBL,	14.	;LENGTH OF A DOS MAGTAPE LABEL

.EQUATE	ANSLBL,	80.	;LENGTH OF AN ANSI MAGTAPE LABEL

.EQUATE	MTULBF,<ANSLBL+<40-1>&<^C<40-1>>> ;BIG (I/O) BUFFER SIZE


.sbttl  Tape service request Queue Block (the TSQ)	;001

.DSECT	,NOCREF

	.BLKW		; Queue link word (forward pointer)		;001
TSQJOB:	.BLKB		; Job number					;006
TSQRTY:	.BLKB		; Retry count and error flag			;001
TSQL3Q:	.BLKW		; Completion queue and L3Q bits to set		;001
TSQIDX:	.BLKB		; Device Index					;001
TSQCEV:	.BLKB		; Request Error value				;001
TSQRET:	.BLKW		; Parameter to return				;001
TSQMTO:	.BLKB		; Open flag word				;006
TSQMAM:	.BLKB		; Memory address of the transfer (msb)		;001
TSQMAL:	.BLKW		; Low order memory address of transfer		;001
TSQCNT:	.BLKW		; Word (or record) count of transfer/operation	;001
TSQCMD:	.BLKB		; Function code of operation			;001
TSQSTS:	.BLKB		; Operation status word				;001
TSQASY:	.BLKW		; Pointer to ASYWRK block			;001
TSQTOT:	.BLKW		; Total Transfer Counter			;001
	.BLKB 	11	; RESERVED for device specific info		;001
TSQPUN:	.BLKB		; Physical Unit Number				;001
TSQSIZ:			; Hokay, the size better = 1 small buffer	;001

; verify layout is correct						;001

.ASSUME	TSQJOB EQ DSQJOB						;006
.ASSUME TSQRTY EQ DSQERR
.ASSUME TSQL3Q EQ DSQL3Q
.ASSUME TSQIDX EQ DSQUNT
.ASSUME TSQMAM EQ DSQMAM
.ASSUME TSQMAL EQ DSQMAL
.ASSUME TSQCNT EQ DSQCNT
.ASSUME TSQCMD EQ DSQFUN
.ASSUME TSQASY EQ DSQMSC
.ASSUME TSQTOT EQ DSQTOT
.ASSUME TSQPUN EQ DSQPUN

.BSECT			; Bit assignments for TSQSTS			;003
			; Note: these assignments are currently MSDVR related
	.BLKB	.		; unused in current driver
TS$RWD:	.BLKB	.		; MTU rewind flag
TS$ECK:	.BLKB	.		; Set when this request is an error check
TS$DNE:	.BLKB	.		; TSQ queued for Done processing (used by rwd)
TS$NOP:	.BLKB	.		; No tape OPeration required for this request
TS$ERR:	.BLKB	.		; Set when Error occured for this request
TS$OUT:	.BLKB	.		; Set when request outstanding (esp. rewinds)
TS$ASY:	.BLKB	.		; Set for Asynchronous Request
