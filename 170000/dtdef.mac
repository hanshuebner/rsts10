TITLE	DTDEF,<COMMON DECTAPE DEFINITIONS>,0A,10-MAY-91,ABC

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR DTDEF
;+
;
;  000  RRF  06-MAR-81	CREATION - COPIED FROM V7.0-07
;
;-

; COMMON DECTAPE DEFINITIONS

.EQUATE	DTRTCT,	12.	;INITIAL RETRY COUNT

.EQUATE	DTDDSP,	14	;NORMAL DISPLACEMENT INTO A DECTAPE DDB

; DECTAPE DDB LAYOUT

.DSECT	-DTDDSP

DTIDX:	.BLKB		;DRIVER INDEX		[DDIDX]
DTSTS:	.BLKB		;STATUS BYTE		[DDSTS]
DTJBNO:	.BLKB		;OWNING JOB NUMBER	[DDJBNO]
DTUNT:	.BLKB		;UNIT NUMBER		[DDUNT]
DTTIME:	.BLKW		;TIME OF OWNERSHIP	[DDTIME]
DTDDCT:	.BLKW		;ACCESS CONTROL		[DDCNT]
DTOFIL:	.BLKB		;INDEX OF OUTPUT FILE OPEN, -1 IF NONE
DTBUFB:	.BLKB		;OFFSET INTO BUFF.SYS (3*UNIT NUMBER)
DTRIO:	.BLKW		;SAVE AREA FOR FIP REQUESTS
DTQPTR:	.BLKW		;DRIVER QUEUE LINK WORD
DTQRET:	.BLKW		;RETURN ADDRESS FOR DRIVER SERVICES
DTRPTR:	.BLKW		;POINTER FOR QUEUEING REQUESTS
DTBUFF:	.BLKW		;BIG BUFFER ADDRESS
DTFQCB:	.BLKW		;FIRQB OR FCB POINTER
DTBLOK:	.BLKW		;BLOCK REQUESTED
DTCFUN:	.BLKB		;CONTROLLER FUNCTION
DTUDIR:	.BLKB		;UNIT NUMBER AND DIRECTION
DTECNT:	.BLKB		;ERROR COUNT/HARDWARE ERROR CODE
DTSERR:	.BLKB		;SOFTWARE ERROR CODE
DTSOPT:	.BLKW		;DIRECTION OPTIMIZATION WORD
DTFIPQ:	.BLKW		;SET TO FIPDTQ FOR FIP CALLS TO DRIVER

; VERIFY CORRECT DDB LAYOUT

.IIF	NE	DTIDX+DTDDSP-DDIDX,	.ERROR
.IIF	NE	DTSTS+DTDDSP-DDSTS,	.ERROR
.IIF	NE	DTJBNO+DTDDSP-DDJBNO,	.ERROR
.IIF	NE	DTUNT+DTDDSP-DDUNT,	.ERROR
.IIF	NE	DTTIME+DTDDSP-DDTIME,	.ERROR
.IIF	NE	DTDDCT+DTDDSP-DDCNT,	.ERROR

.IIF	NE	DTQPTR,			.ERROR
.IIF	NE	DTRPTR-DSQL3Q,		.ERROR

.IIF	NE	DTQRET-BGQRET,		.ERROR
.IIF	NE	DTBUFF-BGBUFF,		.ERROR

.BSECT	HIGH		;IN DTSTS(DDSTS) (AS A WORD)

DDPRVO:	.BLKB	.	;OWNERSHIP REQUIRES PRIV'S
DDRLO:	.BLKB	.	;READ LOCK FOR DEVICE IF SET (NEVER)
DDWLO:	.BLKB	.	;WRITE-LOCK FOR DEVICE IF SET (NEVER)
DDNET:	.BLKB	.	;NETWORK DEVICE (NEVER)
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DDSTAT:	.BLKB	.	;TAPE IS OPEN NFS ON SOME CHANNEL

.BSECT	HIGH		;IN DTDDCT(DDCNT) (AS A WORD)

	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DDCONS:	.BLKB	.	;DEVICE IS THE CONSOLE DEVICE
DDUTIL:	.BLKB	.	;DEVICE ASSIGNED FOR UTILITY SEQUENCE
DDASN:	.BLKB	.	;DEVICE ASSIGNED THROUGH COMMAND

; COMMON BIT ASSIGNMENTS IN "DTST"

.DSECT	3

	.BLKB	31	;EXTENDED DATA BITS
	.BLKB	4	;DATA TRACKS
	.BLKB	.	;MAINTENANCE MARK TRACK
	.BLKB	.	;CLOCK SIMULATES TIMING
	.BLKB	.	;TAPE IS UP TO SPEED
	.BLKB	.	;NON-EXISTENT MEMORY
	.BLKB	.	;DATA MISSED
	.BLKB	.	;BLOCK MISSED
TCSELE:	.BLKB	.	;SELECT ERROR
TCILO:	.BLKB	.	;ILLEGAL OPERATION
TCMTE:	.BLKB	.	;MARK TRACK ERROR
TCPAR:	.BLKB	.	;PARITY ERROR
	.BLKB	.	;END ZONE

; DECTAPE FCB LAYOUT

.DSECT

DDIDX:	.BLKB		;DRIVER INDEX
DDSTS:	.BLKB		;STATUS OF THIS FILE
DDJBNO:	.BLKB		;JOB NUMBER
FQFUN:	.BLKB		;FUNCTION CODE 'DSPFQ' FOR WINDOW TURNS
DTFLEN:	.BLKW		;FILE SIZE
DTFNXB:	.BLKW		;NEXT BLOCK TO READ OR WRITE
DTFPTR:	.BLKW		;PTR TO WINDOW, -1 IF FS READ, 0 IF CTG OR NFS
DTFADR:	.BLKW		;USER VIRTUAL BUFFER ADDRESS
DTFDDB:	.BLKW		;DDB ADDRESS
DTFCNT:	.BLKW		;USER I/O BYTE COUNT
DTFSBL:	.BLKW		;START BLOCK OF FILE
DTFLBL:	.BLKW		;BLOCK JUST READ OR WRITTEN (FS I/O ONLY)
DTFWND:	.BLKW	6	;WINDOW OF ALLOCATD BLOCKS
DTFSIZ:			;SIZE OF DECTAPE FCB

.IIF	NE	DTFSIZ-40,	.ERROR

.BSECT	HIGH		;IN DDSTS BYTE OF FCB (AS A WORD)

DDNFS:	.BLKB	.	;TAPE OPEN NON-FILE STRUCTURED
DDRLO:	.BLKB	.	;TAPE IS OPEN FOR FS WRITE (READ LOCKED)
DDWLO:	.BLKB	.	;TAPE IS OPEN FOR FS READ (WRITE LOCKED)
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DT.CTG:	.BLKB	.	;FILE IS CONTIGUOUS

.EQUATE	ALC.DT,	0	;GET BUFFER FUNCTION (FIP ONLY)
.EQUATE	RNU.DT,	102	;READ BLOCK NUMBER
.EQUATE	RED.DT,	104	;READ DATA
;EQUATE	RAL.DT,	106	;READ ALL
.EQUATE	SST.DT,	010	;STOP SELECTED TRANSPORT
;EQUATE	WTM.DT,	112	;WRITE TIMING & MARK
.EQUATE	WRT.DT,	114	;WRITE DATA
;EQUATE	WAL.DT,	116	;WRITE ALL
.EQUATE	CCE.DT,	200	;OPERATION IS ^C INTERRUPTABLE
.EQUATE	REV.DT,	4000	;REVERSE DIRECTION

; DIRECTORY STRUCTURE ON DECTAPE

.DSECT	70		;DIRECTORY BLOCK NUMBERS ON TAPE

DT$BM0:	.BLKB	10	;FILE BIT MAP BLOCKS (7 MAPS PER BLOCK)
DT$MF0:	.BLKB		;MFD BLOCK 0
DT$MF1:	.BLKB		;MFD BLOCK 1
DT$UF0:	.BLKB		;UFD BLOCK 0
DT$UF1:	.BLKB		;UFD BLOCK 1
DT$PBM:	.BLKB		;MASTER BIT MAP

; DIRECTORY ENTRY IN UFD

.DSECT

DTUNAM:	.BLKW	3	;NAME.EXT IN RAD50
DTUDAT:	.BLKW		;CREATION DATE
DTUMOD:	.BLKW		;MODE (0 FOR RSTS)
DTUSBL:	.BLKW		;STARTING BLOCK
DTULEN:	.BLKW		;LENGTH
DTUEND:	.BLKW		;END BLOCK
DTUPRO:	.BLKW		;PROTECTION CODE

DTU$SZ:			;SIZE OF DIRECTORY ENTRY

; LAYOUT OF BLOCKS STORED IN BUFF.SYS

.DSECT

DTBUF0:	.BLKB		;UFD0 BLOCK BIAS
DTBUF1:	.BLKB		;UFD1 BLOCK BIAS
DTBPBM:	.BLKB		;PBM  BLOCK BIAS

.IIF	NE	DT$UF0-DT$UF0-DTBUF0,	.ERROR
.IIF	NE	DT$UF1-DT$UF0-DTBUF1,	.ERROR
.IIF	NE	DT$PBM-DT$UF0-DTBPBM,	.ERROR

