TITLE	IIDEF,<IBM INTERFACE DDB DEFINITION>,0A,10-MAY-91,SCC/SPC/KPH

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR IIDEF
;+
;
;  000  RRF  06-MAR-81	CREATION - COPIED FROM V7.0-07
;
;			[RSTS/E V9.3]
;  001  KPH  22-Feb-86	Include definitions from IIDVR for IIDINT to use
;
;-

.SBTTL	IBM INTERFACE DRIVER DDB LAYOUT

.DSECT

DDIDX:	.BLKB			;DRIVER INDEX (IDX.II)
DDSTS:	.BLKB			;STATUS AND ACCESS CONTROL BYTE
DDJBNO:	.BLKB			;OWNER JOB NUMBER TIMES 2 (0 IF FREE)
DDUNT:	.BLKB			;DEVICE UNIT NUMBER
DDTIME:	.BLKW			;DEVICE OWN TIME
DDCNT:	.BLKW			;INIT COUNT AND ASSIGNMENT CONTROL
DDFLAG:	.BLKW			;OVERALL STATUS 
IILTTP:	.BLKW			;POINTER TO LTT FOR THIS II
IIBBP:	.BLKW			;BRIDGE BLOCK POINTER
IILTTN:	.BLKB			;# OF LOGICAL TERMINALS
IICUA:	.BLKB			;CONTROL UNIT ADDR FOR THIS II
IIDCNT:	.BLKW			;DEFAULT MAX PENDING I/O COUNT
IIPRID:	.BLKW			;PRODUCT ID
IISIZE:				;SIZE OR IIDDB

; DEFINE PRODUCT ID

.BSECT				;IN IIPRID

	.BLKB	.		;RESERVED
II3271:	.BLKB	.		;RSTS/KMC-3271
II2780:	.BLKB	.		;RSTS/KMC-2780
II3780:	.BLKB	.		;RSTS/KMC-3780

.SBTTL	LOGICAL TERMINAL TABLE

.DSECT

LTTJBN:	.BLKB			;JOB # * 2
LTTCHN:	.BLKB			;CHANNEL # * 2
LTTDEV:	.BLKB			;LOGICAL TERMINAL ID
	.BLKB			;RESERVED
LTTMD:	.BLKB			;OPEN MODE
LTTSTA:	.BLKB			;STATUS
LTTOUT:	.BLKW			;WAITING OUTPUT IRB POINTER
LTTIRB:	.BLKW			;WAITING INPUT IRB CHAIN POINTER
LTTCNT:	.BLKW			;PENDING OUTPUT COUNT
LTTSIZ:				;SIZE OR LTT

.SBTTL	IRB AND BRIDGE BLOCK DEFINITIONS
 
; DEFINE IRB
 
.DSECT
IRBFUN:	.BLKW		;FUNCTION CODE & ITS MODIFIER
IRBSTA:	.BLKW		;STATUS
IRBCHN:	.BLKB		;CHANNEL #
IRB18M:	.BLKB		;MS 2 BITS OF 18 BIT UNIBUS ADDR OF DATA WITHIN BUF
IRB18L:	.BLKW		;LS 16 BITS OF 18 BIT UNIBUS ADDR OF DATA WITHIN BUF
IRBMOD:	.BLKW		;DATA MODIFIER
IRBCON:	.BLKW		;CONTROTED ADDR FOR BIG BUF
IRBNXT:	.BLKW		;LINK TO NEXT IRB (IF CHAINED)
IRBBFL:	.BLKW		;DATA LENGTH IN THE BIG BUF
IRBPAR:	.BLKW		;PARAMETERS PASSING OVER (MAY BE MORE THAN ONE)
 
; DEFINE FUNCTION CODE
 
PUTFCN	=	0*400	;FUNCTION PUT
OPNFCN	=	2*400	;FUNCTION OPEN
CLSFCN	=	4*400	;FUNCTION CLOSE
FWRABT	=	201	;FUNCTION SUB-MODIFIER - FORWARD ABORT REQUEST
 
; DEFINE IRBFUN FOR RSTS/KMC-2780/3780
; TO IBM ONLY
 
DATOUT	=	1	;DATA OUTPUT
EOTOUT	=	3	;SEND EOT
SETDTR	=	5	;SET DTR
CLRDTR	=	11	;DROP DTR WITH DRAIN
DATTOU	=	21	;DATA OUTPUT IN X'PARENCY
OFFDTR	=	41	;DROP DTR WITHOUT DRAIN
 
; DEFINE IRBMOD FOR RSTS/KMC-2780/3780
; FROM IBM ONLY
 
DATAIN	=	4	;NORAML DATA-IN
RVIIN	=	10	;RVI-IN
EOTIN	=	12	;EOT-IN
DATTIN	=	14	;X'PARENT DATA-IN
 
; DEFINE BRIDGE BLOCK
 
.DSECT
 
BBSTS:	.BLKB		;BB STATUS
BBDOFF:	.BLKB		;DATA OFFSET
BBGIRB:	.BLKW		;SUBROUTINE ADDR TO GET IRB/BIG BUF
BBASND:	.BLKW		;SUBROUTINE ADDR TO SEND IRB/BIG BUF
BBAAP5:	.BLKW		;APR5 VALUE FOR THE ABOVE SUBROUTINES
BBDUNT:	.BLKB		;DEVICE CONTROLLER #
BBAUNT:	.BLKB		;AUX PROCESSOR CONTROLLER #
BBDSTA:	.BLKW		;SUBROUTINE ADDR FOR STATUS CHANGED
BBDINT:	.BLKW		;SUBROUTINE ADDR FOR BB INTERRUPT
BBDAP5:	.BLKW		;APR5 VALUE FOR THE ABOVE SUBROUTINES
BBLSTP:	.BLKW		;LST POINTER

.SBTTL	DEFINE CONSTANTS FOR RSTS/KMC-2780/3780
 
; DEFINE OPEN MODE FOR IIDVR
 
NORMMD	=	4		;NORMAL MODE
TRANMD	=	10		;TRANSPARENCY MODE
MTOMD	=	20		;MASTER TERMINAL OPERATION MODE
 
; DEFINE CONTROL CHARACTERS IN ASCII FOR RSTS/KMC-2780-3780
 
HT	=	11		;"HT"
LF	=	12		;"LF"
DC1	=	21		;"DC1"
DC2	=	22		;"DC2"
DC3	=	23		;"DC3"
EM	=	31		;"EM"
ESC	=	33		;"ESC"
GS	=	35		;"GS" (IGS IN EBCDIC)
RS	=	36		;"RS" (IRS IN EBCDIC)
US	=	37		;"US" (ITB IN EBCDIC)
 
; DEFINE CONTROL CHARACTERS IN EBCDIC FOR RSTS/KMC-2780/3780
 
ETX	=	03		;"ETX"
;HT	=	05		;"HT"
;DC1	=	21		;"DC1"
;DC2	=	22		;"DC2"
;DC3	=	23		;"DC3"
NL	=	25		;"NL"
IGS	=	35		;"IGS"
IRS	=	36		;"IRS"
ITB	=	37		;"ITB"
ETB	=	46		;"ETB"
;ESC	=	47		;"ESC"
 
; DEFINE FLAGS IN LTTMD/LTTSTA IN STATUS CHANNEL FOR RSTS/KMC-2780/3780
; THESE FLAGS WILL BE SET AND CLEAR AS FOLLOWING:
;
;		SET			CLEAR
;
; IIEOT		INIT. OR EOT SENT	DATA ARE BEING SENT
; IIDTR		UPDATE WHENEVER TIMES OUT
; IITIMO	SET AS KMC PASS TO II:	ANY ACTIVITIES ON THE LINE
; IIFIRB	INIT. OR RCVD ETX/EOT	RCVD 1ST BLOCK OF DATA
; IIETX		RCVD BLK WITH ETX	RCVD BLK WITH ETB
; IIPUN		SELECTED AS PUNCH	SELECTED AS PRINTER
; IISTX		CONVERSATIONAL STX-IN	RECEIVED ETX/EOT
; IIDDTR	DISC REQ BY SPOOLER	SET DTR BY SPOOLER
;		ERROR 220 OR INIT.
; IIDISC	RECEIVED DLE-EOT	SET DTR BY SPOOLER
; IIRVI		RECEIVED RVI		RECEIVED EOT
; IIDIN		DATA-IN			RECEIVED EOT
; IIFBRK	RECEIVED ETB-EOT	DATA-IN
; IICON		WHEN CONNECTION IS MADE	WHEN CONNECTION IS BROKEN
; IINAK		SET AS KMC PASS TO II:	SPOOLER READ STATUS CHANNEL
; IITOUT	SET AS KMC PASS TO II:	SPOOLER READ STATUS CHANNEL
 
.BSECT				;IN LTTMD/LTTSTA IN STATUS CHANNEL
 
IIEOT:	.BLKB	.		;EOT SENT
IIDTR:	.BLKB	.		;DATA TERMINAL READY
IITIMO:	.BLKB	.		;TIME-OUT/NAK 3 TIMES FOR TRANSMISION
IIFIRB:	.BLKB	.		;NEXT BLK IS 1ST BLK OF DATA, CHECK FOR SEL
IIETX:	.BLKB	.		;RECEIVED BLOCK TERMINATED WITH "ETX"
IIPUN:	.BLKB	.		;SELCTED AS PUNCH
IISTX:	.BLKB	.		;CONVERSATIONAL MODE STX-IN
IIDDTR:	.BLKB	.		;DROP DTR REQ BY SPOOLER
IIDISC:	.BLKB	.		;DISCONNECT REQUESTED BY REMOTE END
IIRVI:	.BLKB	.		;RVI RECEIVED
IIDIN:	.BLKB	.		;DATA-IN
IIFBRK:	.BLKB	.		;REMOTE SYSTEM BROKE FILE
IIEVF:	.BLKB	.		;EVENT FLAG (CLEAR WHEN SPOOLER READ ST CHAN)
IICON:	.BLKB	.		;CONNECTION ESTABLISHED (DATA SET READY)
IINAK:	.BLKB	.		;LINE DOWN/NAK COUNT EXCEEDED (128 TIMES)
IITOUT:	.BLKB	.		;LINE DOWN/TIME-OUT COUNT EXCEEDED (128 TIMES)
 
 
; RSTS/KMC-2780/3780
;  FIELD LTTDEV AND LTTDEV+1 HAS BEEN USED FOR OTHER PURPOSE:
;
;	STATUS CHANNEL		CONTAINS # OF SEC FOR LINE DEAD TIMER
;	READER CHANNEL		CONTAINS # OF CHAR PER CARD
;	PRINTER CHANNEL		LTTDEV CONTAINS SAVED BLOCK TERMINATOR
;				LTTDEV+1 CONTAINS PREVIOUS CARRIAGE CTL CHAR
;	PUNCH CHANNEL		LTTDEV CONTAINS SAVED BLOCK TERMINATOR
;
;  FIELD LTTMD AND LTTSTS FOR STATUS CHANNEL ARE CONBINED TO STORE STATUS.
;
;  FIELD LTTMD AND LTTSTS FOR PRINTER CHANNEL CONTAINS A POINTER TO TAB REC.
;
;	TAB RECORD HAS THE FOLLOWING FORMAT:
;	    WORD 0	PRINTER LINE WIDTH
;	    WORD 1	FLAG FOR TAB RECORD
;	    WORD 2-73	TAB RECORD

