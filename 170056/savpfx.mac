TITLE	SAVPFX,<SAV/RES PREFIX FILE>,0A,10-MAY-91,JDB

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR SAVRES PREFIX

;+
;
;  002  JDB  07-OCT-82  ADDED PACK STATUS INFO TO PRIME LABEL	;JDB002
;  003  JDB  25-APR-84  ADDED INSTALL OPTION			;JDB003
;  004  JDB  15-MAY-85  Made Dev name in Mount tables static	;JDB004
;  005  JDB  17-MAY-85  ADDED BADNER (52.) TO ERROR DEF'S	;JDB005
;
;-


.SBTTL	MACROS

.MACRO	ERF	M
	MESSAG	<<177><200>"??? Fatal SAV/RES bug: ">
.IF	NB	<M>
MESSAG	<M>
.IFF
.ERROR	;NO MESSAGE FOR ERF
.ENDC
	EXIT
.ENDM


.SBTTL	I/O BUFFER OFFSETS

	.DSECT
MTAG1:	.BLKW	2		;MAGTAPE TAG FOR SAVE CLUSTER 1
BUFBEG:	.BLKW	<256.*8.-2.>	;START OF BUFFER DATA
MTAG2:	.BLKW	2		;MAGTAPE TAG FOR SAVE CLUSTER 2
BUFMID:	.BLKW	<256.*8.-2.>	;MIDDLE OF BUFFER
BUFENS:	.BLKW	2		;END OF 16 BLOCK BUFFER
BUFEND:				;END OF I/O BUFFER WITH 2 WORD TAG
	UNORG

.SBTTL	SAVE LABEL OFFSETS

	.DSECT
SLNAM:	.BLKW	2		;SAVE SET NAME
SLDCR:	.BLKW			;DATE OF CREATION
SLTCR:	.BLKW			;TIME OF CREATION
SLEXP:	.BLKW			;DATE OF EXPIRATION
SLSEQ:	.BYTE			;VOLUME SEQUENCE NUMBER
	.BYTE			;UNUSED
SLOTYP:	.BLKW			;ORIGINAL DISK TYPE
SLOIDX:	.BYTE			;ORIGINAL DISK INDEX
SLOPCS:	.BYTE			;ORIGINAL DISK PACK CLUSTER SIZE
SLODCR:	.BLKW			;ORIGINAL DISK CREATION DATE
SLOSIZ:	.BLKW	2		;ORIGINAL DISK SIZE
SLOAPC:	.BLKW			;# ALLOCATED PC'S ON ORIGINAL DISK
	.BLKW	3		;UNUSED
SLSATL:	.BLKW			;SATT.SYS LENGTH
SLSAT1:	.BLKW			;POINTER TO FIRST SATT.SYS
SLSAT2:	.BLKW			;POINTER TO SECOND SATT.SYS
SLDAT:	.BLKW			;POINTER TO DATA BLOCKS
SLDIR:	.BLKW			;POINTER TO DIRECTORY BLOCKS
	.EVEN			;ENSURE SLSIZ IS EVEN
SLSIZ:				;SIZE OF SAVE LABEL
	UNORG

.SBTTL	PRIME LABEL BLOCK OFFSETS

	.DSECT
	.BLKW	256.		;BYPASS THE BOOT BLOCK
PLBBEG:	.BLKW	40.		;BEGINNING OF PRIME LABEL BLOCK
				;ANSI MAGTAPE LABEL (CURRENTLY UNUSED)
PLBVOL:	.BLKW	16.		;VOLUME NAME
PLBBBA:	.BLKW	2		;ADDRESS OF BAD BLOCK FILE
PLBBBL:	.BLKW	2		;LENGTH OF BAD BLOCK FILE
PLBINA:	.BLKW	2		;ADDRESS OF INIT IMAGE
PLBINL:	.BLKW	2		;LENGTH OF INIT IMAGE
PLBSLA:	.BLKW	2		;ADDRESS OF SAVE LABEL
PLBSLL:	.BLKW	2		;LENGTH OF SAVE LABEL
PLBSLB:	.BLKW	2		;ADDRESS OF FIRST SECONDARY LABEL BLOCK
				;(CURRENTLY NOT USED)
PLBSTA:	.BLKW	1		;ORIGINAL PACK STATUS BYTE		;JDB002
				;(INDICATES FILE STRUCTURE STYLE)	;JDB002
PLBRST:	.BLKW	99.		;AREA RESERVED FOR RSTS/E(CURR. UNUSED)	;JDB002
PLBSDC:	.BLKW	68.		;AREA RESERVED FOR SDC USE (CURRENTLY UNUSED)
PLBDSL:				;DEC STANDARD LABEL
PLBDSP:	.BLKW	6		;DEC STANDARD PACK ID
PLBDSO:	.BLKW	6		;DEC STANDARD OWNER
PLBDSF:	.BLKW	6		;DEC STANDARD FORMAT
	.EVEN			;ENSURE PLBSIZ IS EVEN
PLBSIZ:				;SIZE OF PRIME LABEL BLOCK
	UNORG

.SBTTL	SAVE SET RECORD TYPES

	.BSECT , NOCREF
SAVLAB:	.BLKB			;SAVE LABEL
SATTS:	.BLKB			;SATT.SYS COPIES
DATBLK:	.BLKB			;DATA BLOCKS
DIRBLK:	.BLKB			;DIRECTORY BLOCKS
	UNORG

.SBTTL	DEFINE THE MOUNT TABLE (MNTTBL) OFFSETS.
	.DSECT
MNTTYP:	.BLKW			;DEVICE TYPE.  (*)		;JDB004
MNTPID:	.BLKW	2		;PACK ID (RAD-50).
MNTIDX:	.BLKB			;DRIVE INDEX.
MNTUNT:	.BLKB			;DRIVE UNIT NUMBER.
MNTDCR:	.BLKW			;DATE OF CREATION. (*)
MNTTCR:	.BLKW			;TIME OF CREATION.
MNTEXP:	.BLKW			;EXPIRATION DATE. (*)
MNTDEN: .BLKW			;MAGTAPE DENSITY. (*)
MNTFMT:	.BLKB			;DEVICE FORMAT.
MNTDCS:	.BLKB			;DEVICE CLUSTERSIZE.
MNTPCS:	.BLKB			;PACK CLUSTERSIZE.
MNTCLU:	.BLKB			;CLUSTER RATIO.
MNTSZL:	.BLKW			;DEVICE SIZE (LSB).
MNTSZM:	.BLKW			;DEVICE SIZE (MSB).
MNTMFB:	.BLKW	2		;MAXIMUM SAVE CLUSTER FBN.
MNTSIZ:				;SIZE OF THE MOUNT TABLES
	UNORG

;	DEVICE FORMAT BYTE (MNTFMT)
	.BSECT , NOCREF
FMTRST:	.BLKB	.		;RSTS FILE STRUCTURED
FMTSAV:	.BLKB	.		;SAVE FORMAT (LINEAR FORMAT)
FMTUND:	.BLKB	.		;FORMAT UNDEFINED
	UNORG

.SBTTL	DEFINE SAVE SET VOLUME TABLE (SSVOL) OFFSETS
	.DSECT
SSDTYP:	.BLKW			;DEFAULT DEVICE TYPE (ASCII)(*)	;JDB004
SSNAM:	.BLKW	2		;SAVE SET NAME
SSDIDX:	.BLKB			;DEFAULT DEVICE INDEX
SSSEQ:	.BLKB			;VOLUME SEQ. NUMBER
SSDCR:	.BLKW			;DATE OF CREATION (*)
SSTCR:	.BLKW			;TIME OF CREATION 
SSEXP:	.BLKW			;DATE OF EXPIRATION (*)
SSDEN:	.BLKW			;SAVE SET MAGTAPE DENSITY (*)
SSHIDX:	.BLKB			;HANDLER INDEX
	.BLKB			;UNUSED
SSSATL:	.BLKW			;SATT.SYS LENGTH
SSSAT1:	.BLKW			;POINTER TO SATT 1
SSSAT2:	.BLKW			;POINTER TO SATT 2
SSDAT:	.BLKW			;POINTER TO DATA
SSDIR:	.BLKW			;POINTER TO DIRECTORY BLOCKS
SSSIZ:				;SIZE OF SSVOL TABLE
	UNORG

.SBTTL	DEFINE ORIGINAL DISK INFO TABLE (ORGDSK) OFFSETS
	.DSECT
ORGTYP:	.BLKW			;DISK TYPE
ORGIDX:	.BLKB			;DISK INDEX
ORGPCS:	.BLKB			;PACK CLUSTER SIZE
ORGDCR:	.BLKW			;CREATION DATE
ORGSZL:	.BLKW			;DISK SIZE (LSB)
ORGSZM:	.BLKW			;DISK SIZE (MSB)
ORGAPC:	.BLKW			;# ALLOCATED PC'S
ORGSIZ:				;SIZE OF ORGDSK TABLE
	UNORG

;  *  - ALL STARRED ITEMS MUST REMAIN IN GIVEN TABLE LOCATIONS

.SBTTL	MOUNT FLAG (MNTFLG) ASSIGNMENTS
	.BSECT	,NOCREF
NOMSG:	.BLKB	.		;MESSAGE ALREADY PRINTED
PACKID:	.BLKB	.		;PACKID/SSN SPECIFIED
DEVICE:	.BLKB	.		;DEVICE MNEMONIC SPECIFIED
DIALMT:	.BLKB	.		;DIALOGUE MOUNT
DISERR:	.BLKB	.		;ISSUE DISMOUNT ON ERROR
WAITNG:	.BLKB	.		;'WAITING' IN MOUNT
ONLIN:	.BLKB	.		;<>0 MEANS ONLINE, 0 MEANS OFFLINE
DIRTY:	.BLKB	.		;RSTS DISK IS DIRTY
	UNORG

;	OPERATION REQUESTED (OPFLG) ASSIGNMENT - DO NOT CHANGE ORDER
	.BSECT ,NOCREF
OPBD:	.BLKB	.		;1  - NONE OF THE FOLLOWING
OPIM:	.BLKB	.		;2  - IMAGE COPY REQUESTED
OPSV:	.BLKB	.		;4  - SAVE REQUESTED
OPRE:	.BLKB	.		;8  - RESTORE REQUESTED
OPIN:	.BLKB	.		;16 - INSTALL REQUESTED			;JDB003
OPID:	.BLKB	.		;32 - IDENTIFY REQUESTED		;JDB003
OPHE:	.BLKB	.		;64 - HELP REQUESTED			;JDB003
	UNORG

;	SPECIFIED SWITCH FLAG (SWTWRD)
	.BSECT	,NOCREF
VE:	.BLKB	.		;/VERIFY
NOVE:	.BLKB	.		;/NOVERIFY
ER:	.BLKB	.		;/ERROR
NOER:	.BLKB	.		;/NOERROR
ST:	.BLKB	.		;/STATS
NOST:	.BLKB	.		;/NOSTATS
EX:	.BLKB	.		;/EXPIRATION (NO DATE)
EXDAT:	.BLKB	.		;/EXPIRATION:DATE
NOEX:	.BLKB	.		;/NOEXPIRATION
SCR:	.BLKB	.		;/SCRATCH
DEN:	.BLKB	.		;/DENSITY
	UNORG

.SBTTL	SAVE DEVICES IN-USE TABLE OFFSETS

	.DSECT
DEVIDX:	.BLKW			;DEVICE INDEX
DEVUNT:	.BLKW			;DEVICE UNIT
DEVDCS:	.BLKW			;DEVICE DCS
DEVCLU:	.BLKW			;DEVICE CLUSTER RATIO
DEVPCS:	.BLKW			;DEVICE PCS
DEVSEG:	.BLKW			;DEVICE SATT BLOCK LENGTH
DEVBYT:	.BLKW			;DEVICE SATT BYTE LENGTH
DEVBIT:	.BLKW			;DEVICE # PACK CLUSTERS
DEVFCS:	.BLKW			;DEVICE CURRENT FILE CLUSTER SIZE
DEVMUC:	.BLKW			;DEVICE CURRENT UFD/MFD CLUSTER SIZE
DEVSIZ:				;SIZE OF SAVUNT TABLE
	UNORG


.SBTTL	ERROR DEFINITIONS

	.EQUATE	NOROOM,	4.
	.EQUATE	NOSUCH,	5.
	.EQUATE	NOTAVL,	8.
	.EQUATE	EOF,	11.
	.EQUATE	DATERR,	13.
	.EQUATE	HNGDEV,	14.
	.EQUATE	MAGSEL,	39.
	.EQUATE MAGRLE,	40.
	.EQUATE	BADNER,	52.					;JDB005

