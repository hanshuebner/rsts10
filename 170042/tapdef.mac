.IIF	NDF	L$$IST,	.NLIST
.IIF	NDF	L$$IST,	.DSABL CRF
TITLE	TAPDEF,<REGISTER DEFINITIONS - TAPES>,0A,10-MAY-91,ABC/TPT

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	EDIT HISTORY FOR TAPDEF
;+
;
;  000	RRF  06-MAR-81	CREATION - COPIED FROM V7.0-07
;  001	TPT  13-Jan-86	Add TSQ definitions
;
;-

; TM11/TU10 MAGTAPE HARDWARE DEFINITIONS

.DSECT	-2,NOCREF
MTAS:	.BLKW			;STATUS REGISTER
MTAC:	.BLKW			;COMMAND REGISTER
MTABRC:	.BLKW			;BYTE/RECORD COUNT
MTACMA:	.BLKW			;CORE ADDRESS REGISTER
MTARDB:	.BLKW			;DATA BUFFER REGISTER
MTARDL:	.BLKW			;READ LINES

; STATUS REGISTER BITS
.BSECT	,NOCREF
MTTUR:	.BLKB	.		;TAPE UNIT READY
MTRWS:	.BLKB	.		;REWIND STATUS
MTWRL:	.BLKB	.		;WRITE LOCK ON
MTSDWN:	.BLKB	.		;SETTLE DOWN TIME
MTCH79:	.BLKB	.		;9 TRACK = 0, 7 TRACK = 1
MTBOT:	.BLKB	.		;BEGINNING OF TAPE
MTSELR:	.BLKB	.		;SELECT REMOTE
MTNXM:	.BLKB	.		;NON-EXISTENT MEMORY ERROR
MTBTE:	.BLKB	.		;BAD TAPE ERROR
MTRLE:	.BLKB	.		;RECORD LENGTH ERROR
MTEOT:	.BLKB	.		;END OF TAPE
MTBGL:	.BLKB	.		;BUS GRANT LATE
MTPAE:	.BLKB	.		;PARITY ERROR
MTCRE:	.BLKB	.		;CYCLICAL REDUNDANCY ERROR
MTEOF:	.BLKB	.		;END OF FILE
MTILC:	.BLKB	.		;ILLEGAL COMMAND

; COMMAND REGISTER BITS
.EQUATE	MTERR	, 100000,NOCREF	;SOME ERROR
.EQUATE	MTDEN	,  60000,NOCREF	;DENSITY
				; 0 = 200 BPI 7 TRACK
				; 1 = 556 BPI 7 TRACK
				;10 = 800 BPI 7 TRACK
				;11 = 800 BPI 7/9 TRACK DUMP
.EQUATE	MTPWRC	,  10000,NOCREF	;POWER CLEAR
.EQUATE	MTPAR	,   4000,NOCREF	;PARITY (1=EVEN)
.EQUATE	MTUNIT	,   3400,NOCREF	;UNIT NUMBER
.EQUATE	MTCUR	,    200,NOCREF	;CONTROL UNIT READY
.EQUATE	MTINT	,    100,NOCREF	;INTERRUPT ENABLE
.EQUATE	MTADEX	,     60,NOCREF	;ADDRESS EXTENSION
.EQUATE	MTCMMD	,     16,NOCREF	;0 = OFF-LINE
				;1 = READ
				;2 = WRITE
				;3 = WRITE EOF
				;4 = SKIP
				;5 = BACKSPACE
				;6 = WRITE WITH EXTENDED GAP
				;7 = REWIND
.EQUATE	MTGOB	,      1,NOCREF	;GO BIT

; READ LINES BITS
.EQUATE	MTGPSD	,  10000,NOCREF	;GAP SHUTDOWN

; TM02/TU16 MAGTAPE HARDWARE DEFINITIONS

.DSECT	,NOCREF
	.BLKW			;CONTROL
RHWC:	.BLKW			;WORD COUNT
RHBA:	.BLKW			;BUS ADDRESS
MMFC:	.BLKW			;FRAME COUNTER
RHCS2:	.BLKW			;STATUS
RHDS:	.BLKW			;DRIVE STATUS
RHER:	.BLKW			;ERROR REGISTER 1
RHAS:	.BLKW			;ATTENTION SUMMARY
	.BLKW			;CHARACTER CHECK
	.BLKW			;DATA BUFFER
	.BLKW			;MAINTENANCE REGISTER
RHDT:	.BLKW			;DRIVE TYPE
	.BLKW			;SERIAL NUMBER
MMTC:	.BLKW			;TAPE CONTROL REGISTER

; STATUS REGISTER BITS
.EQUATE	MMEOT	,   2000,NOCREF	;END OF TAPE
.EQUATE	MMPES	,     40,NOCREF	;PHASE ENCODED STATUS
.EQUATE	MMSDN	,     20,NOCREF	;SLOWING DOWN
.EQUATE	MMEOF	,      4,NOCREF	;END OF FILE
.EQUATE	MMBOT	,      2,NOCREF	;BEGINNING OF TAPE

; ERROR REGISTER BITS
.BSECT	,NOCREF
	.BLKB	.		;ILLEGAL FUNCTION
	.BLKB	.		;ILLEGAL REGISTER
	.BLKB	.		;REGISTER MODIFICATION REFUSED
MMCPAR:	.BLKB	.		;PARITY ERROR ON CONTROL BUS
MMFMT:	.BLKB	.		;FORMAT ERROR
MMDPAR:	.BLKB	.		;PARITY ERROR ON DATA BUS
MMINC:	.BLKB	.		;INCORRECTABLE DATA ERROR/VPE
MMPEF:	.BLKB	.		;FORMAT ERROR/LRC
MMBTE:	.BLKB	.		;NON STANDARD GAP
MMFCE:	.BLKB	.		;FRAME COUNT ERROR
MMCS:	.BLKB	.		;CORRECTIBLE SKEW/ILLEGAL TAPE MARK
MMNEF:	.BLKB	.		;NON EXECUTABLE FUNCTION
MMDTE:	.BLKB	.		;DRIVE TIMING ERROR
MMOPI:	.BLKB	.		;OPERATION INCOMPLETE
	.BLKB	.		;UNSAFE
MMCOR:	.BLKB	.		;CORRECTIBLE DATA ERROR/CRC ERROR

; DRIVE TYPE BIT VALUE
.EQUATE	MMDT	, 142011,NOCREF	;TM02/TU16 DRIVE TYPE
				; NSA + TAP + SPR + CODE 11

; TC11 DECTAPE HARDWARE DEFINITIONS

.DSECT	-2,NOCREF
DT.CSR:	.BLKW			;ERROR STATUS REGISTER
DT.CMD:	.BLKW			;COMMAND REGISTER
DT.WC:	.BLKW			;WORD COUNT REGISTER
DT.CA:	.BLKW			;CURRENT ADDRESS REGISTER
DT.NUM:	.BLKW			;DATA REGISTER - BLOCK # ON SEARCH

; COMMON MAGTAPE DEFINITIONS

.EQUATE	MTRTCT,	-15.	;INITIAL RETRY COUNT (MTRTRY) VALUE

.EQUATE	MTDDSP,	14	;NORMAL OFFSET INTO A MAGTAPE DDB

; MAGTAPE DDB LAYOUT

.DSECT	-MTDDSP

MTIDX:	.BLKB		;DRIVER INDEX		[DDIDX]
MTSTS:	.BLKB		;STATUS BYTE		[DDSTS]
MTJBNO:	.BLKB		;OWNING JOB NUMBER	[DDJBNO]
MTDUNI:	.BLKB		;UNIT NUMBER		[DDUNT]
MTTIME:	.BLKW		;TIME OF OWNERSHIP	[DDTIME]
MTDDCT:	.BLKW		;ACCESS CONTROL		[DDCNT]
MTFLAG:	.BLKB		;FLAGS			[DDFLAG]
MTTM02:	.BLKB		;TM02 UNIT FOR TU16/TU45
MTCRET:	.BLKW		;COMPLETION RETURN VALUE
MTQPTR:	.BLKW		;DRIVER QUEUE LINK WORD
MTQRET:	.BLKW		;RETURN ADDRESS TO DRIVER
MTRPTR:	.BLKW		;POINTER FOR QUEUEING REQUESTS
MTUBUF:	.BLKW		;USER'S VIRTUAL BUFFER ADDRESS
MTCNT:	.BLKW		;BYTE/RECORD COUNT
MTOFLG:	.BLKB		;OPEN FLAG
MTLCEV:	.BLKB		;LAST COMMAND EXIT VALUE
MTRTRY:	.BLKB		;RETRY COUNTER
MTLBLI:	.BLKB		;DOS(0)/ANSI(-1) LABEL INDICATOR
MTCCMD:	.BLKB		;CURRENT COMMAND
MTLCMD:	.BLKB		;LAST COMMAND
MTLCST:	.BLKW		;LAST COMMAND STATUS
MTBCNT:	.BLKW		;'MTU' RETURN ADDR & BLOCK/RECORD COUNTER
MTACB:	.BLKW		;POINTER FOR ANSI FILE CONTROL BLOCK
MTJIOB:	.BLKW		;POINTER TO JOB'S IOB SLOT
MTFQB:	.BLKW		;POINTER TO FIRQB

; VERIFY CORRECT DDB LAYOUT

.IIF	NE	MTIDX+MTDDSP-DDIDX,	.ERROR
.IIF	NE	MTSTS+MTDDSP-DDSTS,	.ERROR
.IIF	NE	MTJBNO+MTDDSP-DDJBNO,	.ERROR
.IIF	NE	MTDUNI+MTDDSP-DDUNT,	.ERROR
.IIF	NE	MTTIME+MTDDSP-DDTIME,	.ERROR
.IIF	NE	MTDDCT+MTDDSP-DDCNT,	.ERROR
.IIF	NE	MTFLAG+MTDDSP-DDFLAG,	.ERROR

.IIF	NE	MTQPTR,			.ERROR
.IIF	NE	MTRPTR-MTQPTR-DSQL3Q,	.ERROR

.IIF	NE	MTQRET-BGQRET,		.ERROR
.IIF	NE	MTUBUF-BGBUFF,		.ERROR

.BSECT	HIGH		;IN MTSTS(DDSTS) (AS A WORD)

DDPRVO:	.BLKB	.	;OWNERSHIP REQUIRES PRIV'S
DDRLO:	.BLKB	.	;READ LOCK FOR DEVICE IF SET [1]
DDWLO:	.BLKB	.	;WRITE-LOCK FOR DEVICE IF SET [0]
DDNET:	.BLKB	.	;NETWORK DEVICE
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DDSTAT:	.BLKB	.	;DENSITY/PARITY DEFAULTS NEED SETTING

.BSECT	HIGH		;IN MTDDCT(DDCNT) (AS A WORD)

	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
DDCONS:	.BLKB	.	;DEVICE IS THE CONSOLE DEVICE
DDUTIL:	.BLKB	.	;DEVICE ASSIGNED FOR UTILTY SEQUENCE
DDASN:	.BLKB	.	;DEVICE ASSIGNED THROUGH COMMAND

.BSECT			;IN MTFLAG(DDFLAG)

MT.NRW:	.BLKB	.	;NO REWIND ON CLOSE
	.BLKB	.	;RESERVED
	.BLKB	.	;RESERVED
MT.PAR:	.BLKB	.	;DEFAULT PARITY SETTING
	.BLKB	120	;RESERVED
MT.DEN:	.BLKB	40	;DEFAULT DENSITY SETTING
	.BLKB	.	;RESERVED

.DSECT	7		;IN MTOFLG

MT.UNT:	.BLKB	1	;UNIT NUMBER
MT.PAR:	.BLKB	.	;1=>EVEN PARITY; 0=>ODD PARITY
MT.OPN:	.BLKB	120	;OPEN FLAG
MT.DEN:	.BLKB	177440	;DENSITY SETTING
MT.FS:	.BLKB	200	;FILE STRUCTURED FLAG

.DSECT			;COMMANDS IN MTCCMD

RWO.MT:	.BLKB		;REWIND THEN OFFLINE
RED.MT:	.BLKB		;READ
WRT.MT:	.BLKB		;WRITE
EOF.MT:	.BLKB		;WRITE END-OF-FILE (TAPE MARK)
REW.MT:	.BLKB		;REWIND
SKP.MT:	.BLKB		;SKIP(SPACE) FORWARD
BSP.MT:	.BLKB		;SKIP(SPACE) BACKWARD
DEN.MT:	.BLKB		;SET DENSITY/PARITY
UNT.MT:	.BLKB		;RETURN UNIT STATUS
FIL.MT:	.BLKB		;RETURN FILE CHARACTERISTICS
RWC.MT:	.BLKB		;REWIND ON CLOSE
GBF.MT:	.BLKB		;GET ANSI LABEL BUFFER

.EQUATE	DOSLBL,	14.	;LENGTH OF A DOS MAGTAPE LABEL

.EQUATE	ANSLBL,	80.	;LENGTH OF AN ANSI MAGTAPE LABEL

.EQUATE	MTULBF,<ANSLBL+<40-1>&<^C<40-1>>> ;BIG (I/O) BUFFER SIZE

;+001
.sbttl  Tape service request Queue Block (the TSQ)	;001

.DSECT	,NOCREF

	.BLKW		; Queue link word (forward pointer)
TSQJOB:	.BLKB		; Job number			
TSQRTY:	.BLKB		; Retry count and error flag	
TSQL3Q:	.BLKW		; Completion queue and L3Q bits to set
TSQIDX:	.BLKB		; Device Index			
TSQCEV:	.BLKB		; Request Error value		
TSQRET:	.BLKW		; Parameter to return		
TSQMTO:	.BLKB		; Open flag word		
TSQMAM:	.BLKB		; Memory address of the transfer (msb)	
TSQMAL:	.BLKW		; Low order memory address of transfer	
TSQCNT:	.BLKW		; Word (or record) count of transfer/operation
TSQCMD:	.BLKB		; Function code of operation	
TSQSTS:	.BLKB		; Operation status word		
TSQASY:	.BLKW		; Pointer to ASYWRK block	
TSQTOT:	.BLKW		; Total Transfer Counter	
	.BLKB 	11	; RESERVED for device specific info
TSQPUN:	.BLKB		; Physical Unit Number		
TSQSIZ:			; Hokay, the size better = 1 small buffer

; verify layout is correct					

.ASSUME	TSQJOB EQ DSQJOB
.ASSUME TSQRTY EQ DSQERR
.ASSUME TSQL3Q EQ DSQL3Q
.ASSUME TSQIDX EQ DSQUNT
.ASSUME TSQMAM EQ DSQMAM
.ASSUME TSQMAL EQ DSQMAL
.ASSUME TSQCNT EQ DSQCNT
.ASSUME TSQCMD EQ DSQFUN
.ASSUME TSQASY EQ DSQMSC
.ASSUME TSQTOT EQ DSQTOT
.ASSUME TSQPUN EQ DSQPUN

.BSECT			; Bit assignments for TSQSTS
			; Note: these assignments are currently MSDVR related
	.BLKB	.		; unused in current driver
TS$RWD:	.BLKB	.		; MTU rewind flag
TS$ECK:	.BLKB	.		; Set when this request is an error check
TS$DNE:	.BLKB	.		; TSQ queued for Done processing (used by rwd)
TS$NOP:	.BLKB	.		; No tape OPeration required for this request
TS$ERR:	.BLKB	.		; Set when Error occured for this request
TS$OUT:	.BLKB	.		; Set when request outstanding (esp. rewinds)
TS$ASY:	.BLKB	.		; Set for Asynchronous Request

;-001

.IIF	NDF	L$$IST,	.ENABL CRF
.IIF	NDF	L$$IST, .LIST
