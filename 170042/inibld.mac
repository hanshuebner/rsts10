	.INCLUDE /CMN:COMMON/
	.INCLUDE /CMN:KERNEL/
	.INCLUDE /INIT:INIPFX/
TITLE	INIBLD,<RSTS/E INIT - BUILD LOAD-TIME STRUCTURES>,0A,10-MAY-91,WJS

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

.SBTTL	Edit history for INIBLD

;+
;
;				[RSTS V9.0]
;  000	WJS  22-Aug-83	CREATION
;
;-


.SBTTL	Order the CSECT's

	DEFORG	BLD		; Load-Time data structure build code

.SBTTL	Builder main driver

INIBLD::NOP			; For ODT-enabling patch
	CALL	BEGINI		; Do START initialization not yet done
	RETURN

.SBTTL	Do preliminary start-up initialization

BEGINI:	MOVB	KTUSR3,STUSR3	; Copy the MMUSR3 flag for final code
	CLR	FLAG22		; Turn off 22 bit mode
	TSTB	FLG22		; Do we have 22 bit addressing ?
	BMI	10$		; No, we can run in 18 bit mode
	BIS	#20,FLAG22	; Yes, turn on 22-bit flag
	TSTB	FLGUMR		; Do we have UMR?
	BMI	10$		; No
	BIS	#40,FLAG22	; Yes, turn on the UNIBUS map flag
10$:	TSTB	@#DSHARD	; Does D space exist??			;014
	BMI	20$		;  No, so skip this all			;014
	BIS	#1,FLAG22	;  Yes, so enable user I/D		;014
	TSTB	DSPACE		; Use separate I&D spaces?
	BEQ	20$		; No
	BIS	#4,FLAG22	; Yes, enable Kernel D space
20$:	RETURN

GLOBAL	<FLG22,FLGUMR,FLGQBU,KTUSR3,DSPACE,DSHARD>
GLOBAL	<STUSR3,FLAG22>		; Cells in final loader comm area

ENDOVL	<BLD>,200

	.END
