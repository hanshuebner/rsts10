TITLE	CMAC,<COMMON MACROS>,08,13-MAY-86,TVG/RGH

;                   Copyright 1974,1990 by Digital Equipment Corporation
;                                  All rights reserved.
;
;          This software is furnished under a license and may be used and copied
;          only  in  accordance  with  the  terms  of  such license and with the
;          inclusion of the above copyright notice.  This software or any copies
;          shall not be provided to any other person.   No title to or ownership
;          of the software is hereby transferred.
;
;          The information in this software is subject to change without notice.
;
;          DIGITAL  assumes  no  responsibility  for the  use, functionality, or
;          reliability of its  software  on equipment  which  is not supplied by
;          DIGITAL.

;+
; THE .NARGS MACRO SETS THE VARIABLE NARGS TO THE NUMBER OF ARGUMENTS
; WITH WHICH .NARGS IS CALLED.
;-

.MACRO	.NARGS	A,B,C,D,E,F,G,H,I
	NARGS	=0
	.IRP	X,<<A>,<B>,<C>,<D>,<E>,<F>,<G>,<H>,<I>>
	  .IIF NB <X>, NARGS=NARGS+1
	.ENDM
.ENDM	.NARGS

;+
; $GO.IF IS A CONDITIONAL GOTO MACRO. ARGUMENT CN IS CONSTRUED AS THE LAST
; TWO CHARACTERS OF A CONDITIONAL BRANCH INSTRUCTION AND AT THE SAME TIME
; AS A CONVENIENT MNEMONIC FOR A CONDITIONAL OPERATOR. CONTROL IS TRANSFERRED
; TO LOCATION LOC IF ARGUMENT A1 STANDS IN RELATION CN TO ARGUMENT A2.
; THE CODE GENERATED BY $GO.IF IS USUALLY A CMP FOLLOWED BY A CONDITIONAL
; BRANCH. HOWEVER, IF A2 IS #0, A TST IS SUBSTITUTED FOR THE CMP IN MOST
; CASES. IN THIS LATTER CIRCUMSTANCE, A BIT IS USED INSTEAD OF THE TST IF
; A1 IS A BRACKETED PAIR OF ARGUMENTS. THE H ARGUMENT IS USUALLY OMITTED;
; IT IS PRESENT AS A "B" IN THOSE CASES WHERE A BYTE TEST IS REQUIRED.
;-

.MACRO	$GO.IF	A1,CN,A2,LOC,H
	.IF NB <A1>
	  .IF DIF <A2>,<#0>
	  CMP'H	A1,A2
	  .IFF
	    .NARGS A1
	    .IF NE NARGS-1
	  BIT'H	A1
	    .IFF
	  TST'H	A1
	    .ENDC
	  .ENDC
	.ENDC
	.IIF NB <CN>,	  B'CN	LOC
.ENDM	$GO.IF

;+
; $EXIT IS THE MACRO FOR EXITING FROM A SUBROUTINE. IF THE REG ARGUMENT IS
; NOT SUPPLIED, PC IS ASSUMED.
;-

.MACRO	$EXIT	REG
	.IF NB REG
	  RTS	REG
	.IFF
	  RTS	PC
	.ENDC
.ENDM	$EXIT

;+
; .MOVB MOVES BYTE B TO REGISTER R WITHOUT SIGN EXTENSION.
;-

.MACRO	.MOVB	B,R
	  CLR	R
	  BISB	B,R
.ENDM	.MOVB

.MACRO	RANGE X,LO,HI,?OUTRNG
	  CMPB	X,#LO
	  BLO	OUTRNG
	  CMPB	X,#HI
	  BHI	OUTRNG
	.IF B	^\OUTRNG\
	  SEZ	
OUTRNG:
	.ENDC
	.ENDM	
;

.MACRO 	COMC
	  BCS	.+6		;IF CARRY SET CLEAR IT 3 LINES DOWN
	  SEC			;ELSE SET CARRY
	  BR	.+4		;AND BRANCH AROUND NEXT WORD
	  CLC			;CLEAR IT HERE
	.ENDM	
;
.MACRO	BIF	LT,EQ,GT	;GENERATES 3-WAY BRANCH
	.IIF	NB ^\LT\,	  BLT	LT
	.IIF	NB ^\EQ\,	  BEQ	EQ
	.IIF	NB ^\GT\,	  BGT	GT
	.ENDM
;
.MACRO	ADDB	SBYTE,REGW,REGT ;ADD BYTE SBYTE TO REGT USING REGW AS WORK REG
	  MOVB	SBYTE,REGW
	  ADD	REGW,REGT
.ENDM

