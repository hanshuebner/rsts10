.INCLUDE	%CMN:COMMON%
TITLE	SAVREG,<REGISTER SAVING COROUTINE>,0A,10-MAY-91,RTW

;
;		COPYRIGHT (c) 1974, 1991 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
; TRANSFERRED.
;
; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
; CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY  OF ITS
; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;

;+
; SAVREG - SAVE REGISTERS, COROUTINE CALL TO CALLER
;
; CALL:	THE ROUTINE USING SAVREG MUST HAVE BEEN ENTERED VIA JSR PC,X
;	CALL	SAVREG,R5
;
; BACK:	ALL REGISTERS SAVED
;	TO RESTORE REGISTERS, MERELY RETURN
;	TO CHANGE SAVE REGISTER RN ON THE STACK,
;		REFERENCE N*2+1(SP)
;	SAVREG RESTORES REGISTERS AND RETURNS TO CALLER'S CALLER
;-
	.PSECT	PBSLIB,RO,CON

SAVREG::MOV	R4,-(SP)
	MOV	R3,-(SP)
	MOV	R2,-(SP)
	MOV	R1,-(SP)
	MOV	R0,-(SP)
	MOV	R5,-(SP)	;RETURN TO CALLER
	MOV	6*2(SP),R5	;FIX R5
	JSR	PC,@(SP)+	;CALL CALLER BACK
	MOV	(SP)+,R0
	MOV	(SP)+,R1
	MOV	(SP)+,R2
	MOV	(SP)+,R3
	MOV	(SP)+,R4
	MOV	(SP)+,R5
	RTS	PC

.END

