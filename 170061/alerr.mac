	.TITLE	ALERR
	.IDENT	/02.01/

;
;		COPYRIGHT (c) 1985 BY
;	DIGITAL EQUIPMENT CORPORATION, MAYNARD
;	 MASSACHUSETTS.  ALL RIGHTS RESERVED.
;
; THIS  SOFTWARE  IS  FURNISHED  UNDER  A LICENSE AND MAY BE USED
; AND  COPIED  ONLY IN  ACCORDANCE WITH THE TERMS OF SUCH LICENSE
; AND WITH  THE INCLUSION  OF THE ABOVE  COPYRIGHT  NOTICE.  THIS
; SOFTWARE  OR ANY OTHER  COPIES  THEREOF, MAY NOT BE PROVIDED OR
; OTHERWISE MADE  AVAILABLE TO ANY OTHER PERSON.  NO TITLE TO AND
; OWNERSHIP OF THE SOFTWARE IS HEREBY TRANSFERED.
;
; THE INFORMATION  IN THIS DOCUMENT IS SUBJECT  TO CHANGE WITHOUT
; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT  BY  DIGITAL
; EQUIPMENT CORPORATION.
;
; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF
; ITS SOFTWARE ON EQUIPMENT THAT IS NOT SUPPLIED BY DIGITAL.
;

;
; MODIFIED BY:
;
; JEP126	25-AUG-81	J.E.POLLACK
;				CORRECT PSECT ATTRIBUTES
;
; BM350		10-JUN-85	B.S.MCCARTHY
;				ADD BOM$ CALL FOR ERROR REPORT
;
; MACRO LIBRARY CALLS
;
 
	.MCALL	DRERR$,	WSIG$S,	BOMDF$,	BOM$S
 
;
; DEFINE DIRECTIVE STATUS ERROR CODES
;
 
	DRERR$
 
;
; DEFINE BREAKPOINT OR MESSAGE CODES
;

	BOMDF$

;+
; **-$ALERR-SUBROUTINE TO HANDLE AUTOLOAD ERRORS
;
; THIS ROUTINE IS CALLED TO PERFORM PARTIAL ERROR RECOVERY WHENEVER A
; SEQMENT LOAD FAILURE OCCURS WHILE AN AUTOLOAD REQUEST IS IN PROGRESS.
; IT IS ONE OF THE OVERLAY RUNTIME ROUTINES.
;
; INPUTS:
;
;	R2 = ADDRESS OF SEGMENT DESCRIPTOR OF SEGMENT
;		WHERE LOAD FAILURE OCCURED.
;
; THE ROUTINE EXECUTES A 'WAITFOR SIGNIFICANT EVENT' DIRECTIVE IF THE DIRECTIVE
; STATUS WORD CONTAINS ERROR CODE 'IE.UPN' (UNAVAILABLE POOL NODE) ELSE A
; BPT INSTRUCTION IS EXECUTED. ON COMPLETION OF THE WAIT A RETURN WILL CAUSE
; THE RUNTIME SYSTEM TO RE-TRY THE LOAD OVERLAY REQUEST. THE CONTENTS OF ALL
; REGISTERS MUST BE PRESERVED.
;
; A RETURN IN-LINE FROM THE BPT SST WILL CAUSE A RE-TRY AS DESCRIBED ABOVE.
;-
 
	.PSECT	$$ALER	I,RO,LCL,REL,CON
 
$ALERR::			;
	CMP	@#$DSW,#IE.UPN	; UNAVAILABLE POOL NODE?
	BNE	10$		; IF NE CAUSE BPT SST
	WSIG$S			; WAIT FOR SIGNIFICANT EVENT
	BR	20$		; EXIT TO RE-TRY
10$:				;
	BOM$S	#S.BOVL,#S.BBIF	; GENERATE BPT SST OR ABORT W/MSG
20$:				;
	RETURN			; EXIT AND RE-TRY LOAD

	.END
