	.TITLE	CREF
	.IDENT	/01/
	.IDENT	/02.01/

;
; COPYRIGHT (C) 1977, 1978
; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE FOR USE ONLY ON A
; SINGLE COMPUTER SYSTEM AND MAY  BE  COPIED   ONLY  WITH  THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE,  OR
; ANY OTHER COPIES THEREOF, MAY NOT BE PROVIDED  OR  OTHERWISE
; MADE AVAILABLE TO ANY OTHER PERSON   EXCEPT FOR  USE ON SUCH
; SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE  TERMS.  TITLE
; TO AND OWNERSHIP OF THE SOFTWARE SHALL AT ALL  TIMES  REMAIN
; IN DEC.
;
; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
; EQUIPMENT CORPORATION.
;
; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF
; ITS SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
;         
; VERSION 02.01
;
; C. MONIA 09-JAN-75
;
; MODIFICATIONS:
;
;		CM001 -- 29-OCT-75
;
;			 DELETE SECOND PASS THROUGH CROSS REFERENCE
;			 INPUT FILE	
;
;
;	JAK001	24-AUG-77	ADD EMIT STATUS
;
;	J. H. MATTHEWS	29-MAR-78
;
;		JM010  ADDED READ ONLY AND READ-WRITE PSECTS FOR IAS.
;
;
;
; CREF EXECUTIVE
;
	.IF	NDF,RSTS	;++RSTS V7.1
	.MCALL	EMST$S
	.ENDC			;++RSTS V7.1

; LOCAL DATA
;
	.PSECT	CREFD,RW

SPSAV:	.BLKW	1		; SAVE INITIAL STACK POINTER

;+
; **-$CREF-CREF EXECUTIVE PROGRAM
; **-$EXIT-TERMINATE CURRENT CREF PROCESSING
;
;-

	.PSECT	CREFI,RO
	.ENABL	LSB


$CREF::				;
	MOV	SP,SPSAV	; MARK THE STACK
	.IF	DF,RSTS		;++RSTS V7.2
	MOV	#EX$SUC,$EXSTS	;++RSTS V7.2  ASSUME SUCCESS
	.IFTF			;++RSTS V7.2
10$:				;
	MOV	SPSAV,SP	; RETRIEVE INITIAL SP
	.IFF			;++RSTS V7.2
	MOV	#EX$SUC,$EXSTS	; ASSUME SUCCESS
	.ENDC			;++RSTS V7.2
	CALL	$CRFIN		; INITIALIZE CREF I/O AND STORAGE
	CALL	$CRFP1		; BUILD SYMBOL TABLES
	CALL	$CRFP3		; APPEND CREF TO OUTPUT FILE
	CALL	$CRFP4		; SPOOL CREF OUTPUT IF NECESSARY
$EXIT::				;
	CALL	$CRFEX		; CLOSE ALL CREF FILES

	.IF	NDF,RSTS	;++RSTS V7.1
	EMST$S	#$RCVBF,$EXSTS	; EMIT STATUS
	.ENDC			;++RSTS V7.1

	BR	10$		; GO AGAIN

	.END	$CREF
