	.TITLE	CRFTB
	.IDENT	/02.03/

;
; COPYRIGHT (C) 1977, 1991
; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;
; THIS SOFTWARE IS FURNISHED UNDER A LICENSE FOR USE ONLY ON A
; SINGLE COMPUTER SYSTEM AND MAY  BE  COPIED   ONLY  WITH  THE
; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE,  OR
; ANY OTHER COPIES THEREOF, MAY NOT BE PROVIDED  OR  OTHERWISE
; MADE AVAILABLE TO ANY OTHER PERSON   EXCEPT FOR  USE ON SUCH
; SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE  TERMS.  TITLE
; TO AND OWNERSHIP OF THE SOFTWARE SHALL AT ALL  TIMES  REMAIN
; IN DEC.
;
; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
; EQUIPMENT CORPORATION.
;
; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF
; ITS SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
;         
; VERSION 02.03
;
; C. MONIA 06-JAN-74
;
; MODIFICATIONS:
;
;		CM001 -- 29-OCT-75
;
;			 DELETE SECOND PASS THROUGH CROSS REFERENCE
;			 INPUT FILE.
;
;		CM002 -- 30-OCT-75
;
;			 ADD MACRO CREF
;	JAK001	24-AUG-77	ADD EXIT WITH STATUS
;
;	J. H. MATTHEWS  11-SEP-78
;
;		JM018  ADDED I/O BLOCK FOR IAS
;
;	P. K. M. W.	15-SEP-83	2.02
;
;		PKW039 - ALLOW TASK TO EXTEND
;
;	S. LeVan	18-Apr-91	2.03
;
;		Merge RSTS-specific code into RSX V4.3 version of this module.
;
; CREF DATA BASE
;
; EQUATED SYMBOLS
;
; CREF FLAGS WORD BIT DEFINITIONS
;

CS$POL==000001			; SPOOL CREF FILE(1=YES)
CS$PD==000400			; COPY FILE TO SPECIAL DEVICE(1=YES)
 
;
; CREF FILE HEADER FLAGS WORD BIT DEFINITIONS
;
 
HD$SH==000001			; SHORT LINE FORMAT OUTPUT (1=YES)

;
; CREF INPUT FILE DATA RECORD OFFSETS
;

	.ASECT

.=0

D$SYM::	.BLKW	2		; SYMBOL NAME (2-WORD RADIX 50)
D$SREF::.BLKW	2		; REFERENCE DOUBLEWORD
D$SVAL::.BLKW	1		; SYMBOL VALUE
D$ATTR::.BLKB	1		; ATTRIBUTES BYTE
D$FMT::	.BLKB	1		; FORMAT BYTE
D$LTH::	.BLKW	1		; LENGTH OF RECORD

;
; SYMBOL TABLE NODE SIZE
;

.=0

	.BLKW	256.		;
N$DLGH::.BLKW	0		; REF LABEL

;
; RECEIVE BUFFER OFFSETS
;

.=4

R$CNAM::.BLKW	3		; LISTING FILE NAME
R$CTYP::.BLKW	1		; LISTING FILE TYPE
R$CVER::.BLKW	1		; LISTING FILE VERSION
R$CDID::.BLKW	3		; LISTING FILE DIRECTORY I/D
R$CDEV::.BLKW	1		; LISTING FILE DEVICE
R$CUNT::.BLKB	1		; LISTING FILE UNIT
R$CFLG::.BLKB	1		; CREF FLAGS BYTE
R$CRVR::.BLKW	1		; CREF FILE VERSION
R$CODV::.BLKW	1		; CREF OUTPUT DEVICE
R$COUN::.BLKB	1		; CREF OUTPUT UNIT

;
; REFERENCE LIST OFFSETS
;

.=0

R$FNXT::.BLKW	1		; LINK TO NEXT REFERENCE(0=NONE)
R$FSYM::.BLKW	2		; REFERENCE DOUBLEWORD KEY
R$FLG::	.BLKW	1		; REFERENCE FLAG WORD
R$FLTH::.BLKW	1		; LENGTH OF REFERENCE LIST ENTRY

;
; SYMBOL TABLE ENTRY OFFSETS
;

.=0

S$YNXT::.BLKW	1		; LINK TO NEXT
S$YPRV::.BLKW	1		; LINK TO PREVIOUS
S$YUP::	.BLKW	1		; LINK UP
S$YM::	.BLKW	2		; SYMBOL NAME (2-WORD, RAD50)
S$YFLG::.BLKW	1		; FLAGS WORD
S$YREF::.BLKW	1		; REFERENCE LISTHEAD
S$YVAL::.BLKW	1		; SYMBOL VALUE
S$YLTH::.BLKW	1		; LENGTH OF ENTRY


	.PSECT

;
; LOCAL DATA
;
; CREF FLAGS WORD
;

$CRFLG::.BLKW	1		;

	.IF	DF,RSTS		;++RSTS V7.1
$CRFGM::.BLKW	1		;++RSTS V7.1
	.ENDC			;++RSTS V7.1

;
; CREF INPUT FILE HEADER RECORD DATA
;

$$0=.
$CRFTK::.BLKW	2		; ORIGINATING TASK NAME
$CRFID::.BLKW	1		; CREF INPUT IDENTIFIER
$CRFDT::.BLKW	5		; CREF FILE CREATION DATE/TIME
$CRFIF::.BLKW	1		; CREF INPUT FILE FLAGS
 
H$DLTH==.-$$0			; LENGTH OF CREF HEADER RECORD
 
;
; CREF PROCESSOR IDENT.
;

$CRIDN::.RAD50	/CREF  /	;
	.WORD	0		;
	.WORD	0		;

;
; SST VECTOR FOR ERROR MESSAGE HANDLER
;

$ERVCT::.WORD	0		;
	.WORD	0		;
	.WORD	0		;
	.WORD	$ERTRP		; IOT TRAP TO ERROR ROUTINE

 
;
; EXIT WITH STATUS WORD
;
 
$EXSTS::.BLKW	1		;
 
;
; FREE CORE POOL LISTHEAD
;

$FRHD::	.BLKW	1		;
	.WORD	0		; SECOND WORD MUST BE ZERO
;
; SIZE OF FREE POOL
;

$FRSIZ::.BLKW	1		;
 
;
; POINTER TO CURRENT FORMAT CONTROL TABLE ENTRY
;
 
$FMTPT::.BLKW	1		;
 
;
; RECEIVE OR EXIT BUFFER
;

$RCVBF::.BLKW	15.		;

	.IF	DF	IAS

CRFIOB::.BLKW	2

	.ENDC

	.END
